/* ****************************************************************************
*
* Copyright (c) Francesco Abbruzzese. All rights reserved.
* francesco@dotnet-programming.com
* http://www.dotnet-programming.com/
* 
* This software is subject to the the license at http://mvccontrolstoolkit.codeplex.com/license  
* and included in the license.txt file of this distribution.
* 
* You must not remove this notice, or any other, from this software.
*
* ***************************************************************************/
function MvcControlsToolkit_Trim(a) { return a.replace(/^\s+|\s+$/g, "") } function GlobalEvalScriptInElementId(d) { var c = ""; if (d.tagName == "SCRIPT") { c = d.text } else { var a = $(d).find("script"); for (var b = 0; b < a.length; b++) { c += a[b].text } } jQuery.globalEval(c) } function GlobalEvalScriptAndDestroy(b) { var a = CollectScriptAndDestroy(b); jQuery.globalEval(a) } function CollectScriptAndDestroy(d) { var c = ""; if (d.tagName == "SCRIPT") { c = d.text; $(d).remove() } else { var a = $(d).find("script"); for (var b = 0; b < a.length; b++) { c += a[b].text } a.remove() } return c } function GlobalEvalScriptInElementIdById(d) { var a = $("#" + d).find("script"); var c = ""; for (var b = 0; b < a.length; b++) { c += a[b].text } jQuery.globalEval(c) } function CollectAllScriptsInelement(d) { var a = $("#" + d).find("script"); var c = ""; for (var b = 0; b < a.length; b++) { c += a[b].text } return c } (function (g) { var h = /^[\],:{}\s]*$/; var m = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g; var l = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g; var d = /(?:^|:|,)(?:\s*\[)+/g; var a = /\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:[.,]\d+)?Z/i; var e = /\/Date\((\d+)(?:-\d+)?\)\//i; var f = /"(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:[.,](\d+))?Z"/i; var k = /"\\\/Date\((\d+)(?:-\d+)?\)\\\/"/i; var j = (window.JSON && window.JSON.parse) ? true : false; var b = j && window.JSON.parse('{"x":9}', function (o, n) { return "Y" }) === "Y"; var c = function (n, o) { if (typeof (o) === "string") { if (a.test(o)) { return new Date(o) } if (e.test(o)) { return new Date(parseInt(e.exec(o)[1], 10)) } } return o }; g.extend({ parseJSON: function (o) { var n = true; if (typeof o !== "string" || !o) { return null } o = g.trim(o); if (h.test(o.replace(m, "@").replace(l, "]").replace(d, ""))) { if (b || (j && n !== true)) { return window.JSON.parse(o, n === true ? c : undefined) } else { o = n === true ? o.replace(f, "new Date(parseInt('$1',10),parseInt('$2',10)-1,parseInt('$3',10),parseInt('$4',10),parseInt('$5',10),parseInt('$6',10),(function(s){return parseInt(s,10)||0;})('$7'))").replace(k, "new Date($1)") : o; return (new Function("return " + o))() } } else { g.error("Invalid JSON: " + o) } } }) })(jQuery); var ValidationType_StandardClient = "StandardClient"; var ValidationType_UnobtrusiveClient = "UnobtrusiveClient"; var ValidationType_Server = "Server"; function MvcControlsToolkit_Validate(g, b) { if (b == ValidationType_StandardClient) { if (typeof document.getElementById(g)[MvcControlsToolkit_FieldContext_Tag] === "undefined") { return } var f = null; try { f = document.getElementById(g)[MvcControlsToolkit_FieldContext_Tag].validate("blur") } catch (d) { } if (f && f.length) { return false } else { return true } } else { if (b == ValidationType_UnobtrusiveClient) { var a = "#" + g; var c = true; try { c = $(a).parents("form").validate().element(a) } catch (d) { } return c } } return true } function MvcControlsToolkit_FormIsValid(d, a) { if (a == ValidationType_StandardClient) { var b = null; $("#" + d).parents("form").each(function (e) { b = this[MvcControlsToolkit_FieldContext_formValidationTag] }); if (b == null) { return true } var c = b.validate("submit"); if (c && c.length) { return false } else { return true } } else { if (a == ValidationType_UnobtrusiveClient) { return $("#" + d).parents("form").validate().form() } else { return true } } } var MvcControlsToolkit_FieldContext_hasValidationFiredTag = "__MVC_HasValidationFired"; var MvcControlsToolkit_FieldContext_formValidationTag = "__MVC_FormValidation"; var MvcControlsToolkit_FieldContext_Tag = "__MVC_FieldContext"; var MvcControlsToolkit_SpecialFormName = "_Template_Data_"; function MvcControlsToolkit_FormContext$_isElementInHierarchy(a, b) { if (b == null) { return false } while (b) { if (a === b) { return true } b = b.parentNode } return false } function MvcControlsToolkit_FieldContext$validate(a) { if (typeof Sys === "undefined" || Sys === null || typeof Sys.Mvc === "undefined" || Sys.Mvc === null || typeof Sys.Mvc.FormContext === "undefined" || Sys.Mvc.FormContext === null) { return } for (var b = 0; b < this.elements.length; b++) { if (!MvcControlsToolkit_FormContext$_isElementInHierarchy(document.body, this.elements[b])) { this.clearErrors(); return [] } } return this.baseValidate(a) } function MvcControlsToolkit_FieldContext$enableDynamicValidation() { for (var b = 0; b < this.elements.length; b++) { var a = this.elements[b]; a[MvcControlsToolkit_FieldContext_Tag] = this } this.baseEnableDynamicValidation() } if (typeof Sys !== "undefined" && Sys !== null && typeof Sys.Mvc !== "undefined" && Sys.Mvc !== null && typeof Sys.Mvc.FormContext !== "undefined" && Sys.Mvc.FormContext !== null) { Sys.Mvc.FieldContext.prototype.baseValidate = Sys.Mvc.FieldContext.prototype.validate; Sys.Mvc.FieldContext.prototype.validate = MvcControlsToolkit_FieldContext$validate; Sys.Mvc.FieldContext.prototype.baseEnableDynamicValidation = Sys.Mvc.FieldContext.prototype.enableDynamicValidation; Sys.Mvc.FieldContext.prototype.enableDynamicValidation = MvcControlsToolkit_FieldContext$enableDynamicValidation; Sys.Mvc.FieldContext.prototype._dependsOn = new Array(); Sys.Mvc.FieldContext.prototype._dependencyOnBlur = function (a) { this.validate("blur") }; Sys.Mvc.FieldContext.prototype.takeDynamicValue = function (h) { var g = null; if (this.elements.length > 0) { g = this.elements[0] } if (g == null) { return null } var e = g.name; var d = e.lastIndexOf("."); if (d >= 0) { var c = e.substring(d + 1); var a = g.id; a = a.substring(0, a.lastIndexOf(c)); h = a + h } var f = document.getElementById(h); if (f == null) { return null } var b = false; if (this._dependsOn == null) { this._dependsOn = new Array(); this._dependsOn[h] = f; b = true } else { if (typeof this._dependsOn[h] === "undefined") { this._dependsOn[h] = f; b = true } } if (b) { Sys.UI.DomEvent.addHandler(f, "blur", Function.createDelegate(this, this._dependencyOnBlur)) } return f.value }; Sys.Mvc.ValidatorRegistry.validators.dynamicrange = function (c) { var a = c.ValidationParameters.min; var b = c.ValidationParameters.max; return function (f, e) { if (!f || !f.length) { return true } var d = Number.parseLocale(f); if (!isNaN(d) && (a == null || a <= d) && (b == null || d <= b)) { return true } return c.ErrorMessage } }; Sys.Mvc.ValidatorRegistry.validators.clientdynamirange = function (d) { var c = d.ValidationParameters.min; var e = d.ValidationParameters.max; var a = d.ValidationParameters.mindelay; var b = d.ValidationParameters.maxdelay; return function (l, g) { if (!l || !l.length) { return true } var f = Number.parseLocale(l); var k = null; var m = null; if (c != null) { var h = g.fieldContext.takeDynamicValue(c); if (h != null) { k = Number.parseLocale(h); if (isNaN(k)) { k = null } else { if (a != null) { k = k + a } } } } if (e != null) { var j = g.fieldContext.takeDynamicValue(e); if (j != null) { m = Number.parseLocale(j); if (isNaN(m)) { m = null } else { if (b != null) { m = m + b } } } } if (!isNaN(f) && (k == null || k <= f) && (m == null || f <= m)) { return true } return d.ErrorMessage } }; Sys.Mvc.ValidatorRegistry.validators.daterange = function (rule) { var sminValue = rule.ValidationParameters.min; var smaxValue = rule.ValidationParameters.max; var minValue = null; var maxValue = null; if (sminValue != null) { sminValue = "new " + sminValue.substring(1, sminValue.length - 1); minValue = eval(sminValue) } if (smaxValue != null) { smaxValue = "new " + smaxValue.substring(1, smaxValue.length - 1); maxValue = eval(smaxValue) } return function (value, context) { if (!value || !value.length) { return true } var convertedValue = Date.parseLocale(value); if (convertedValue != null && (minValue == null || minValue <= convertedValue) && (maxValue == null || convertedValue <= maxValue)) { return true } return rule.ErrorMessage } }; Sys.Mvc.ValidatorRegistry.validators.clientdynamicdaterange = function (f) { var e = f.ValidationParameters.min; var g = f.ValidationParameters.max; var a = f.ValidationParameters.mindelay; var b = f.ValidationParameters.maxdelay; var c = null; var d = null; return function (m, j) { if (!m || !m.length) { return true } var h = Date.parseLocale(m); if (e != null) { var k = j.fieldContext.takeDynamicValue(e); if (k != null) { c = Date.parseLocale(k); if (a != null) { c = new Date(c.getTime() + a) } } } if (g != null) { var l = j.fieldContext.takeDynamicValue(g); if (l != null) { d = Date.parseLocale(l); if (b != null) { d = new Date(d.getTime() + b) } } } if (h != null && (c == null || c <= h) && (d == null || h <= d)) { return true } return f.ErrorMessage } } } if (typeof $ !== "undefined" && $ !== null && typeof $.validator !== "undefined" && $.validator !== null && typeof $.validator.unobtrusive !== "undefined" && $.validator.unobtrusive !== null) { (function (a) { a.validator.takeDynamicValue = function (e, k) { if (e == null) { return null } var b = e.name; var f = b.lastIndexOf("."); if (f >= 0) { var h = b.substring(f + 1); var c = e.id; c = c.substring(0, c.lastIndexOf(h)); k = c + k } var d = document.getElementById(k); if (d == null) { return null } var g = false; var j = jQuery.data(e, "_dependsOn"); if (typeof j == "undefined" || j == null) { j = new Array(); j[k] = d; jQuery.data(e, "_dependsOn", j); g = true } else { if (typeof j[k] === "undefined") { j[k] = d; g = true } } if (g) { a(d).blur(function () { a(e).parents("form").first().validate().element(e) }) } return d.value }; a.validator.unobtrusive.clearAndParse = function (b) { var c = a(b).parents("form"); if (c.length != 0) { c.removeData("validator") } else { a(b).removeData("validator") } a.validator.unobtrusive.parse(b) }; a.validator.unobtrusive.parseExt = function (b) { a.validator.unobtrusive.parse(b); var e = a(b).first().closest("form"); var d = e.data("unobtrusiveValidation"); var c = e.validate(); a.each(d.options.rules, function (g, f) { if (c.settings.rules[g] == undefined) { var h = {}; a.extend(h, f); h.messages = d.options.messages[g]; a('[name= "' + g + '"]').rules("add", h) } else { a.each(f, function (l, k) { if (c.settings.rules[g][l] == undefined) { var j = {}; j[l] = k; j.messages = d.options.messages[g][l]; a('[name= "' + g + '"]').rules("add", j) } }) } }) } })($); $.validator.unobtrusive.adapters.addBool("mandatory", "required"); $.validator.addMethod("dynamicrange", function (d, b, f) { var c = f[0]; if (c == "") { c = null } var e = f[1]; if (e == "") { e = null } if ((!d || !d.length) && this.optional(b)) { return true } var a = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { a = jQuery.global.parseFloat(d) } else { a = parseFloat(d) } if (!isNaN(a) && (c == null || c <= a) && (e == null || a <= e)) { return true } return false }, "value is not in the required range"); jQuery.validator.unobtrusive.adapters.add("dynamicrange", ["min", "max"], function (b) { var c = b.params.min, a = b.params.max; b.rules.dynamicrange = [c, a]; if (b.message) { b.messages.dynamicrange = b.message } }); $.validator.addMethod("clientdynamirange", function (m, h, e) { var f = e[0]; if (f == "") { f = null } var a = e[2]; if (a == "") { a = null } var g = e[1]; if (g == "") { g = null } var c = e[3]; if (c == "") { c = null } var l = null; var k = null; if (g != null) { g = parseFloat(g) } if (c != null) { c = parseFloat(c) } if ((!m || !m.length) && this.optional(h)) { return true } var b = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { b = jQuery.global.parseFloat(m) } else { b = parseFloat(m) } if (f != null) { var j = $.validator.takeDynamicValue(h, f); if (j != null) { l = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { l = jQuery.global.parseFloat(j) } else { l = parseFloat(j) } if (isNaN(l)) { l = null } else { if (g != null) { l = l + g } } } } if (a != null) { var d = $.validator.takeDynamicValue(h, a); if (d != null) { k = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { k = jQuery.global.parseFloat(d) } else { k = parseFloat(d) } if (isNaN(k)) { k = null } else { if (c != null) { k = k + c } } } } if (!isNaN(b) && (l == null || l <= b) && (k == null || b <= k)) { return true } return false }, "value is not in the required range"); jQuery.validator.unobtrusive.adapters.add("clientdynamirange", ["min", "mindelay", "max", "maxdelay"], function (a) { var b = a.params.min, c = a.params.mindelay; max = a.params.max, maxdelay = a.params.maxdelay; a.rules.clientdynamirange = [b, c, max, maxdelay]; if (a.message) { a.messages.clientdynamirange = a.message } }); $.validator.addMethod("daterange", function (d, b, f) { var c = f[0]; if (c == "") { c = null } var e = f[1]; if (e == "") { e = null } if (c != null) { c = new Date(c) } if (e != null) { e = new Date(e) } if ((!d || !d.length) && this.optional(b)) { return true } var a = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { a = new Date(d); a = jQuery.global.parseDate(d) } else { a = new Date(d) } if (!isNaN(a) && (c == null || c <= a) && (e == null || a <= e)) { return true } return false }, "date is not in the required range"); jQuery.validator.unobtrusive.adapters.add("daterange", ["min", "max"], function (b) { var c = b.params.min, a = b.params.max; b.rules.daterange = [c, a]; if (b.message) { b.messages.daterange = b.message } }); $.validator.addMethod("clientdynamicdateRange", function (m, h, e) { var f = e[0]; if (f == "") { f = null } var a = e[2]; if (a == "") { a = null } var g = e[1]; if (g == "") { g = null } var c = e[3]; if (c == "") { c = null } var l = null; var k = null; if (g != null) { g = parseInt(g) } if (c != null) { c = parseInt(c) } if ((!m || !m.length) && this.optional(h)) { return true } var b = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { b = jQuery.global.parseDate(m) } else { b = parseDate(m) } if (f != null) { var j = $.validator.takeDynamicValue(h, f); if (j != null) { l = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { l = jQuery.global.parseDate(j) } else { l = parseDate(j) } if (isNaN(l)) { l = null } else { if (g != null) { l = new Date(l.getTime() + g) } } } } if (a != null) { var d = $.validator.takeDynamicValue(h, a); if (d != null) { k = null; if (typeof jQuery.global !== "undefined" && typeof jQuery.global.parseFloat === "function") { k = jQuery.global.parseDate(d) } else { k = parseDate(d) } if (isNaN(k)) { k = null } else { if (c != null) { k = new Date(k.getTime() + c) } } } } if (!isNaN(b) && (l == null || l <= b) && (k == null || b <= k)) { return true } return false }, "date is not in the required range"); jQuery.validator.unobtrusive.adapters.add("clientdynamicdateRange", ["min", "mindelay", "max", "maxdelay"], function (a) { var b = a.params.min, c = a.params.mindelay; max = a.params.max, maxdelay = a.params.maxdelay; a.rules.clientdynamicdateRange = [b, c, max, maxdelay]; if (a.message) { a.messages.clientdynamicdateRange = a.message } }) } var DualSelect_Separator = ";;;"; var DualSelect_SelectAvial = "_AvialSelect"; var DualSelect_SelectSelected = "_SelSelect"; var DualSelect_HiddenSelectedItemsVal = ""; var DualSelect_TempObjSource, DualSelect_TempObjDestination; function DualSelect_SetObjects(b, a) { if (a) { DualSelect_TempObjSource = document.getElementById(b + DualSelect_SelectAvial); DualSelect_TempObjDestination = document.getElementById(b + DualSelect_SelectSelected) } else { DualSelect_TempObjSource = document.getElementById(b + DualSelect_SelectSelected); DualSelect_TempObjDestination = document.getElementById(b + DualSelect_SelectAvial) } } function DualSelect_GetIndexForInsert(b, c) { if (b.autosort == "false") { return b.length + 1 } if (b.length == 0) { return 0 } for (var a = 0; a < b.length; a++) { if (b[a].text > c.text) { return a } } return b.length } function DualSelect_MoveElement(c, a) { DualSelect_SetObjects(c, a); if (DualSelect_TempObjSource.length == 0) { return } iLast = 0; for (var b = 0; b < DualSelect_TempObjSource.length; b++) { if (DualSelect_TempObjSource[b].selected) { iLast = b; var d = DualSelect_TempObjSource[b]; DualSelect_TempObjSource.remove(b); nPos = (DualSelect_TempObjDestination.length + 1); DualSelect_TempObjDestination.options.add(d, DualSelect_GetIndexForInsert(DualSelect_TempObjDestination, d)); b-- } } DualSelect_SaveSelection(c); if (DualSelect_TempObjSource.length > 0 && iLast == 0) { DualSelect_TempObjSource.selectedIndex = 0 } else { if (DualSelect_TempObjSource.length - 1 >= iLast) { DualSelect_TempObjSource.selectedIndex = iLast } else { if (DualSelect_TempObjSource.length >= 1) { DualSelect_TempObjSource.selectedIndex = iLast - 1 } } } DualSelect_ClearSelection(DualSelect_TempObjSource); DualSelect_TempObjSource.focus } function DualSelect_Move_Up(e, a) { DualSelect_SetObjects(e, a); if (DualSelect_TempObjSource.length == 0) { return } if (DualSelect_TempObjSource[0].selected) { return } for (var b = 1; b < DualSelect_TempObjSource.length; b++) { if (DualSelect_TempObjSource[b].selected) { var d = DualSelect_TempObjSource[b]; var c = DualSelect_TempObjSource[b - 1]; DualSelect_TempObjSource.remove(b); DualSelect_TempObjSource.remove(b - 1); DualSelect_TempObjSource.options.add(d, b - 1); DualSelect_TempObjSource.options.add(c, b); b-- } } DualSelect_SaveSelection(e) } function DualSelect_Move_Down(e, a) { DualSelect_SetObjects(e, a); if (DualSelect_TempObjSource.length == 0) { return } if (DualSelect_TempObjSource[DualSelect_TempObjSource.length - 1].selected) { return } for (var b = DualSelect_TempObjSource.length - 2; b > -1; b--) { if (DualSelect_TempObjSource[b].selected) { var d = DualSelect_TempObjSource[b]; var c = DualSelect_TempObjSource[b + 1]; DualSelect_TempObjSource.remove(b + 1); DualSelect_TempObjSource.remove(b); DualSelect_TempObjSource.options.add(c, b); DualSelect_TempObjSource.options.add(d, b + 1); b++ } } DualSelect_SaveSelection(e) } function DualSelect_MoveAll(b, a) { DualSelect_SetObjects(b, a); while (DualSelect_TempObjSource.length > 0) { oNode = DualSelect_TempObjSource[0]; DualSelect_TempObjSource.remove(DualSelect_TempObjSource[0]); DualSelect_TempObjDestination.options.add(oNode, DualSelect_GetIndexForInsert(DualSelect_TempObjDestination, oNode)) } DualSelect_SaveSelection(b) } function DualSelect_ClearSelection(b) { for (var a = 0; a < b.length; a++) { b[a].selected = false } } function DualSelect_SaveSelection(d) { var b = document.getElementById(d + DualSelect_SelectSelected); var c = ""; var e = ""; for (var a = 0; a < b.length; a++) { c += b[a].value + DualSelect_Separator } document.getElementById(d + DualSelect_HiddenSelectedItemsVal).value = c } var defaultYear = 1970 + 0; var defaultMonth = 0 + 0; var defaultDay = 1 + 0; var defaultHour = 0 + 0; var defaultMinute = 0 + 0; var defaultSecond = 0 + 0; function DateInput_Initialize(id) { if (document.getElementById(id + "_Year") != null) { document.getElementById(id + "_Year").onkeypress = DateInputYearKeyVerify; document.getElementById(id + "_Year").onpaste = DateInputYearHandlePaste; document.getElementById(id + "_Year").ondrop = DateInputYearHandlePaste; document.getElementById(id + "_Year").onchange = DateInputChanged } if (document.getElementById(id + "_Month") != null) { document.getElementById(id + "_Month").onchange = DateInputChanged } if (document.getElementById(id + "_Day") != null) { document.getElementById(id + "_Day").onchange = DateInputChanged } if (document.getElementById(id + "_Hours") != null) { document.getElementById(id + "_Hours").onchange = DateInputChanged } if (document.getElementById(id + "_Minutes") != null) { document.getElementById(id + "_Minutes").onchange = DateInputChanged } if (document.getElementById(id + "_Seconds") != null) { document.getElementById(id + "_Seconds").onchange = DateInputChanged } if (eval(id + "_DateInCalendar")) { var options = eval(id + "_CalendarOptions"); $("#" + id + "_Calendar").datepicker(options); DateInputChanged(null, id, true) } } function DateInputGetNumDays(b, a) { b = b + 1; if (a % 4 == 0) { return (b == 9 || b == 4 || b == 6 || b == 11) ? 30 : (b == 2) ? 29 : 31 } else { return (b == 9 || b == 4 || b == 6 || b == 11) ? 30 : (b == 2) ? 28 : 31 } } function DateTimeAdjustYears(d, c, a) { if (d == null) { return } var b = 0; if (c == d.options[0].value && a == d.options[d.options.length - 1].value) { return } var e = d.value; d.options.length = 0; for (i = c; i <= a; i++) { if (i < 10) { d.options[b] = new Option("   " + i, i) } else { if (i < 100) { d.options[b] = new Option("  " + i, i) } else { if (i < 1000) { d.options[b] = new Option(" " + i, i) } else { d.options[b] = new Option("" + i, i) } } } b++ } MvcControlsToolKit_SetDateElement(d.id, e) } function DateTimeAdjustMonthes(d, c, a) { if (d == null) { return } var b = 0; if (c == d.options[0].value && a == d.options[d.options.length - 1].value) { return } var e = d.value; d.options.length = 0; for (i = c; i <= a; i++) { d.options[b] = new Option(DateTimeMonthes[i], i + 1); b++ } MvcControlsToolKit_SetDateElement(d.id, e) } function DateTimeAdjustDays(d, c, a) { if (d == null) { return } var b = 0; if (c == d.options[0].value && a == d.options[d.options.length - 1].value) { return } var e = d.value; d.options.length = 0; for (i = c; i <= a; i++) { if (i < 10) { d.options[b] = new Option(" " + i, i) } else { d.options[b] = new Option("" + i, i) } b++ } MvcControlsToolKit_SetDateElement(d.id, e) } function DateTimeAdjustTimeElement(d, c, a) { if (d == null) { return } var b = 0; if (c == d.options[0].value && a == d.options[d.options.length - 1].value) { return } var e = d.value; d.options.length = 0; for (i = c; i <= a; i++) { if (i < 10) { d.options[b] = new Option("0" + i, i) } else { d.options[b] = new Option("" + i, i) } b++ } MvcControlsToolKit_SetDateElement(d.id, e) } function DateInputYearHandlePaste(a) { a = (a) ? (a) : ((window.event) ? (window.event) : null); if (a == null) { return true } var b = (a.target) ? (a.target) : ((event.srcElement) ? (event.srcElement) : null); if (b == null) { return true } var c; if (a.type == "paste") { c = window.clipboardData.getData("Text") } else { if (a.type == "drop") { c = a.dataTransfer.getData("Text") } else { return true } } for (i = 0; i < c.length; i++) { keyCode = c.charCodeAt(i); if (keyCode == 13 || keyCode == 8) { continue } if ((keyCode >= 48) && (keyCode <= 57)) { continue } else { return false } } b.value = c; return false } function DateInputYearKeyVerify(a) { a = (a) ? (a) : ((window.event) ? (window.event) : null); if (a == null) { return true } var b = (a.target) ? (a.target) : ((event.srcElement) ? (event.srcElement) : null); if (b == null) { return true } var c = ((a.charCode || a.initEvent) ? a.charCode : ((a.which) ? a.which : a.keyCode)); if (c == 0 || c == 13 || c == 8) { return true } if ((c >= 48) && (c <= 57)) { return true } return false; var d = b.value } function DateTimeInput_UpdateCalendar(a) { Nanno = document.getElementById(a + "_Year").value; Nmese = document.getElementById(a + "_Month").value; Ngiorno = document.getElementById(a + "_Day").value; var b = new Date(Nanno, Nmese - 1, Ngiorno); var c = $("#" + a + "_Calendar"); var d = c.datepicker("option", "dateFormat"); if (d == null) { d = "mm/dd/yy" } c.datepicker("setDate", $.datepicker.formatDate(d, b)) } function DateTimeInput_UpdateFromCalendar(d, a) { var h = $("#" + a + "_Calendar"); if (d == null) { return } var j = h.datepicker("option", "dateFormat"); if (j == null) { j = "mm/dd/yy" } var b = null; try { b = $.datepicker.parseDate(j, d) } catch (g) { b = new Date() } var f = h.datepicker("option", "minDate"); var k = h.datepicker("option", "maxDate"); var l = null; var c = null; if (f != null) { l = $.datepicker.parseDate(j, f) } if (k != null) { c = $.datepicker.parseDate(j, k) } if (l != null && b < l) { b = l } if (c != null && b > c) { b = c } document.getElementById(a + "_Year").value = b.getFullYear(); document.getElementById(a + "_Month").value = b.getMonth() + 1; document.getElementById(a + "_Day").value = b.getDate(); DateInputChanged(null, a, true) } function DateTimeInput_UpdateCalendarMinMax(a, c, e) { var b = $("#" + a + "_Calendar"); var d = b.datepicker("option", "dateFormat"); if (d == null) { d = "mm/dd/yy" } if (c != null) { b.datepicker("option", "minDate", $.datepicker.formatDate(d, c)) } else { b.datepicker("option", "minDate", null) } if (e != null) { b.datepicker("option", "maxDate", $.datepicker.formatDate(d, e)) } else { b.datepicker("option", "maxDate", null) } } function DateInputChanged(evt, cid, update) { var clientID; if (cid == null) { evt = (evt) ? (evt) : ((window.event) ? (window.event) : null); if (evt == null) { return false } var sorg = (evt.target) ? (evt.target) : ((event.srcElement) ? (event.srcElement) : null); if (sorg == null) { return false } clientID = sorg.id.substring(0, sorg.id.lastIndexOf("_")) } else { clientID = cid } if (eval(clientID + "Recursive") == true) { return } eval(clientID + "Recursive = true;"); var Nanno; var Nmese; var Ngiorno; var NHours; var NMinutes; var NSeconds; var CurrDate = eval(clientID + "_Curr"); var CurrDay = CurrDate.getDate(); var CurrMonth = CurrDate.getMonth(); var CurrYear = CurrDate.getFullYear(); var CurrHours = CurrDate.getHours(); var CurrMinutes = CurrDate.getMinutes(); var CurrSeconds = CurrDate.getSeconds(); var currMin = eval(clientID + "_MinDate"); var currMax = eval(clientID + "_MaxDate"); var dynamicMin = null; if (eval("(typeof " + clientID + "_ClientDynamicMin !== 'undefined') && (" + clientID + "_ClientDynamicMin != null)") == true) { dynamicMin = eval(clientID + "_ClientDynamicMin()") } var dynamicMax = null; if (eval("(typeof " + clientID + "_ClientDynamicMax !== 'undefined') && (" + clientID + "_ClientDynamicMax != null)") == true) { dynamicMax = eval(clientID + "_ClientDynamicMax()") } if (dynamicMin != null && (currMin == null || dynamicMin > currMin)) { if (dynamicMin > currMax) { currMin = currMax } else { currMin = dynamicMin } } if (dynamicMax != null && (currMax == null || dynamicMax < currMax)) { if (dynamicMax < currMin) { currMax = currMin } else { currMax = dynamicMax } } if (document.getElementById(clientID + "_Year") != null) { Nanno = document.getElementById(clientID + "_Year").value } else { Nanno = CurrYear } if (document.getElementById(clientID + "_Month") != null) { Nmese = document.getElementById(clientID + "_Month").value } else { Nmese = CurrMonth } if (document.getElementById(clientID + "_Day") != null) { Ngiorno = document.getElementById(clientID + "_Day").value } else { Ngiorno = CurrDay } if (document.getElementById(clientID + "_Hours") != null) { NHours = document.getElementById(clientID + "_Hours").value } else { NHours = CurrHours } if (document.getElementById(clientID + "_Minutes") != null) { NMinutes = document.getElementById(clientID + "_Minutes").value } else { NMinutes = CurrMinutes } if (document.getElementById(clientID + "_Seconds") != null) { NSeconds = document.getElementById(clientID + "_Seconds").value } else { NSeconds = CurrSeconds } var TempNewDate = new Date(Nanno, Nmese - 1, Ngiorno, NHours, NMinutes, NSeconds); if (currMax != null && currMax < TempNewDate) { TempNewDate = currMax } if (currMin != null && currMin > TempNewDate) { TempNewDate = currMin } Nanno = TempNewDate.getFullYear() + ""; Nmese = (TempNewDate.getMonth() + 1) + ""; Ngiorno = TempNewDate.getDate() + ""; NHours = TempNewDate.getHours() + ""; NMinutes = TempNewDate.getMinutes() + ""; NSeconds = TempNewDate.getSeconds() + ""; var NewYear; var NewMonth; var NewDay; var NewHours; var NewMinutes; var NewSeconds; var MaxYear; var MinYear; var MaxMonth; var MinMonth; var MinDay; var MaxDay; var MinHours; var MaxHours; var MinMinutes; var MaxMinutes; var MinSeconds; var MaxSeconds; eval(clientID + "_Valid = true"); NewYear = parseInt(Nanno); if (!isNaN(NewYear)) { if (currMax == null) { MaxYear = null } else { MaxYear = currMax.getFullYear() } if (currMin == null) { MinYear = null } else { MinYear = currMin.getFullYear() } if (MaxYear != null && MaxYear < NewYear) { NewYear = MaxYear } if (MinYear != null && MinYear > NewYear) { NewYear = MinYear } if (document.getElementById(clientID + "_Year") != null && !eval(clientID + "_DateHidden") && eval(clientID + "_YearCombo") && !eval(clientID + "_DateInCalendar")) { DateTimeAdjustYears(document.getElementById(clientID + "_Year"), MinYear, MaxYear) } if ((MaxYear == null || MaxYear >= NewYear) && (MinYear == null || MinYear <= NewYear)) { MaxMonth = 11; MinMonth = 0; if (MaxYear == NewYear) { MaxMonth = currMax.getMonth() } if (MinYear == NewYear) { MinMonth = currMin.getMonth() } NewMonth = parseInt(Nmese); if (!isNaN(NewMonth)) { NewMonth = NewMonth - 1; if (MinMonth > NewMonth) { NewMonth = MinMonth } if (MaxMonth < NewMonth) { NewMonth = MaxMonth } if (CurrYear == MinYear || CurrYear == MaxYear || NewYear == MinYear || NewYear == MaxYear) { if (document.getElementById(clientID + "_Month") != null && !eval(clientID + "_DateHidden") && !eval(clientID + "_DateInCalendar")) { DateTimeAdjustMonthes(document.getElementById(clientID + "_Month"), MinMonth, MaxMonth) } } MinDay = 1; MaxDay = DateInputGetNumDays(NewMonth, NewYear); if (MaxYear == NewYear && MaxMonth == NewMonth) { MaxDay = currMax.getDate() } if (MinYear == NewYear && MinMonth == NewMonth) { MinDay = currMin.getDate() } NewDay = parseInt(Ngiorno); if (!isNaN(NewDay)) { if (MinDay > NewDay) { NewDay = MinDay } if (MaxDay < NewDay) { NewDay = MaxDay } if (document.getElementById(clientID + "_Day") != null && !eval(clientID + "_DateHidden") && !eval(clientID + "_DateInCalendar")) { DateTimeAdjustDays(document.getElementById(clientID + "_Day"), MinDay, MaxDay) } MinHours = 0; MaxHours = 23; if (MaxYear == NewYear && MaxMonth == NewMonth && NewDay == MaxDay) { MaxHours = currMax.getHours() } if (MinYear == NewYear && MinMonth == NewMonth && NewDay == MinDay) { MinHours = currMin.getHours() } NewHours = parseInt(NHours); if (!isNaN(NewHours)) { if (MaxHours < NewHours) { NewHours = MaxHours } if (NewHours < MinHours) { NewHours = MinHours } if (document.getElementById(clientID + "_Hours") != null) { DateTimeAdjustTimeElement(document.getElementById(clientID + "_Hours"), MinHours, MaxHours) } MinMinutes = 0; MaxMinutes = 59; if (MaxYear == NewYear && MaxMonth == NewMonth && NewDay == MaxDay && MaxHours == NewHours) { MaxMinutes = currMax.getMinutes() } if (MinYear == NewYear && MinMonth == NewMonth && NewDay == MinDay && MinHours == NewHours) { MinMinutes = currMin.getMinutes() } NewMinutes = parseInt(NMinutes); if (!isNaN(NewMinutes)) { if (MaxMinutes < NewMinutes) { NewMinutes = MaxMinutes } if (MinMinutes > NewMinutes) { NewMinutes = MinMinutes } if (document.getElementById(clientID + "_Minutes") != null) { DateTimeAdjustTimeElement(document.getElementById(clientID + "_Minutes"), MinMinutes, MaxMinutes) } MinSeconds = 0; MaxSeconds = 59; if (MaxYear == NewYear && MaxMonth == NewMonth && NewDay == MaxDay && MaxHours == NewHours && MaxMinutes == NewMinutes) { MaxSeconds = currMax.getSeconds() } if (MinYear == NewYear && MinMonth == NewMonth && NewDay == MinDay && MinHours == NewHours && MinMinutes == NewMinutes) { MinSeconds = currMin.getSeconds() } NewSeconds = parseInt(NSeconds); if (!isNaN(NewSeconds)) { if (MaxSeconds < NewSeconds) { NewSeconds = MaxSeconds } if (NewSeconds < MinSeconds) { NewSeconds = MinSeconds } if (document.getElementById(clientID + "_Seconds") != null) { DateTimeAdjustTimeElement(document.getElementById(clientID + "_Seconds"), MinSeconds, MaxSeconds) } } else { eval(clientID + "_Valid = false") } } else { eval(clientID + "_Valid = false") } } else { eval(clientID + "_Valid = false") } } else { eval(clientID + "_Valid = false") } } else { eval(clientID + "_Valid = false") } } } else { eval(clientID + "_Valid = false") } if (eval(clientID + "_DateInCalendar")) { DateTimeInput_UpdateCalendarMinMax(clientID, MinYear == null ? null : new Date(MinYear, MinMonth, MinDay), MaxYear == null ? null : new Date(MaxYear, MaxMonth, MaxDay)) } var AChange = false; if (eval(clientID + "_Valid")) { if (update == true || (cid == null && (CurrYear != NewYear || CurrMonth != NewMonth || CurrDay != NewDay || CurrHours != NewHours || CurrMinutes != NewMinutes || CurrSeconds != NewSeconds))) { AChange = true } CurrYear = NewYear; CurrMonth = NewMonth; CurrDay = NewDay; CurrHours = NewHours; CurrMinutes = NewMinutes; CurrSeconds = NewSeconds } if (!AChange) { eval(clientID + "Recursive = false;"); return true } eval(clientID + "_Curr = new Date(CurrYear, CurrMonth, CurrDay, CurrHours, CurrMinutes, CurrSeconds)"); if (document.getElementById(clientID + "_Year") != null) { MvcControlsToolKit_SetDateElement(clientID + "_Year", CurrYear) } if (document.getElementById(clientID + "_Month") != null) { MvcControlsToolKit_SetDateElement(clientID + "_Month", CurrMonth + 1) } if (document.getElementById(clientID + "_Day") != null) { MvcControlsToolKit_SetDateElement(clientID + "_Day", CurrDay) } if (eval(clientID + "_DateInCalendar")) { DateTimeInput_UpdateCalendar(clientID) } if (document.getElementById(clientID + "_Hours") != null) { MvcControlsToolKit_SetDateElement(clientID + "_Hours", CurrHours) } if (document.getElementById(clientID + "_Minutes") != null) { MvcControlsToolKit_SetDateElement(clientID + "_Minutes", CurrMinutes) } if (document.getElementById(clientID + "_Seconds") != null) { MvcControlsToolKit_SetDateElement(clientID + "_Seconds", CurrSeconds) } var currDate = eval(clientID + "_Curr"); RefreshDependencies(clientID); eval(clientID + "_ClientDateChanged(" + currDate.getTime() + ")"); $("#" + clientID + "_Hidden").trigger("DateTimeInput_Changed"); eval(clientID + "Recursive = false;"); return true } function MvcControlsToolKit_SetDateElement(d, c) { var b = document.getElementById(d); if (b.tagName == "SELECT") { for (var a = b.options.length - 1; a >= 0; a--) { if (b.options[a].value <= c) { b.selectedIndex = a; return } } b.selectedIndex = 0 } else { if ((c === null) || (c === undefined)) { c = "" } b.value = c } } function SetDateInput(id, value, cType) { if (eval("typeof " + id + "_Curr === 'undefined'") == true) { return } var currDate = eval(id + "_Curr"); if (currDate == null) { return } var currDateInMilliseconds = currDate.getTime(); if (cType == 1 && value >= currDateInMilliseconds) { return } if (cType == 2 && value <= currDateInMilliseconds) { return } var DateInFormat = new Date(value); var currMin = eval(id + "_MinDate"); var currMax = eval(id + "_MaxDate"); if (currMin != null && DateInFormat < currMin) { DateInFormat = currMin } if (currMax != null && DateInFormat > currMax) { DateInFormat = currMax } eval(id + "_Curr = DateInFormat;"); if (document.getElementById(id + "_Hours") != null) { if (document.getElementById(id + "_Year") != null) { MvcControlsToolKit_SetDateElement(id + "_Year", DateInFormat.getFullYear()); DateInputChanged(null, id, false) } if (document.getElementById(id + "_Month") != null) { MvcControlsToolKit_SetDateElement(id + "_Month", DateInFormat.getMonth() + 1); DateInputChanged(null, id, false) } if (document.getElementById(id + "_Day") != null) { MvcControlsToolKit_SetDateElement(id + "_Day", DateInFormat.getDate()); DateInputChanged(null, id, false) } if (document.getElementById(id + "_Hours") != null) { MvcControlsToolKit_SetDateElement(id + "_Hours", DateInFormat.getHours()); DateInputChanged(null, id, false) } if (document.getElementById(id + "_Minutes") != null) { MvcControlsToolKit_SetDateElement(id + "_Minutes", DateInFormat.getMinutes()); DateInputChanged(null, id, false) } if (document.getElementById(id + "_Seconds") != null) { MvcControlsToolKit_SetDateElement(id + "_Seconds", DateInFormat.getSeconds()); DateInputChanged(null, id, true) } } else { if (document.getElementById(id + "_Year") != null) { MvcControlsToolKit_SetDateElement(id + "_Year", DateInFormat.getFullYear()); DateInputChanged(null, id, false) } if (document.getElementById(id + "_Month") != null) { MvcControlsToolKit_SetDateElement(id + "_Month", DateInFormat.getMonth() + 1); DateInputChanged(null, id, false) } if (document.getElementById(id + "_Day") != null) { MvcControlsToolKit_SetDateElement(id + "_Day", DateInFormat.getDate()); DateInputChanged(null, id, true) } } if (eval(id + "_DateInCalendar")) { DateTimeInput_UpdateCalendar(id) } } function GetDateInput(id) { return eval(id + "_Curr") } function MvcControlsToolkit_DateTimeInput_SetString(b, c) { clientID = b.id.substring(0, b.id.lastIndexOf("_")); var a = null; if (c == null || c == "") { a = new Date() } else { a = MvcControlsToolkit_Parse(c, MvcControlsToolkit_DataType_DateTime) } SetDateInput(clientID, a.getTime(), 3) } function MvcControlsToolkit_DateTimeInput_Set(b, c, d, e) { if ($("#" + b.id).length == 0) { var a = function () { MvcControlsToolkit_DateTimeInput_Set(b, c, d, e) }; setTimeout(a, 0); return } clientID = b.id.substring(0, b.id.lastIndexOf("_")); if (c == null || c == "") { c = new Date() } SetDateInput(clientID, c.getTime(), 3) } function MvcControlsToolkit_DateTimeInput_Get(sorg, valueType) { clientID = sorg.id.substring(0, sorg.id.lastIndexOf("_")); return eval(clientID + "_Curr") } function MvcControlsToolkit_DateTimeInput_GetString(a) { clientID = a.id.substring(0, a.id.lastIndexOf("_")); return MvcControlsToolkit_Format(GetDateInput(clientID), "s", MvcControlsToolkit_DataType_DateTime, "", "") } function AddToUpdateList(id, toAdd) { if (id == null || toAdd == null) { return } var currIndex = eval(id + "_UpdateListIndex"); eval(id + "_UpdateList[" + currIndex + "] = '" + toAdd + "';"); currIndex++; eval(id + "_UpdateListIndex = " + currIndex + ";") } function RefreshDependencies(id) { if (eval("typeof " + id + "_UpdateListIndex === 'undefined'") == true) { return } var length = eval(id + "_UpdateListIndex"); if (length == null) { return } for (var i = 0; i < length; i++) { DateInputChanged(null, eval(id + "_UpdateList[" + i + "]"), true) } } var DataButtonCancel = "DataButtonCancel"; var DataButtonDelete = "DataButtonDelete"; var DataButtonUndelete = "DataButtonUndelete"; var DataButtonEdit = "DataButtonEdit"; var DataButtonInsert = "DataButtonInsert"; var DataButtonResetRow = "DataButtonResetRow"; var DisplayPostfix = "_Display"; var EditPostfix = "_Edit"; var OldEditPostfix = "_OldEdit"; var UndeletePostfix = "_Undelete"; var ChangedExternallyPostfix = "_ChangedExternally"; var SavePostFix = "_Save"; var SavePostFixCurr = "_SaveCurr"; var DatagridFielsdPostfix = "_Datagrid_Fields"; var SavePostFixD = "_SaveD"; var SavePostFixU = "_SaveU"; var SavePostFixC = "_SaveC"; var DeletedPostFix = "_Deleted"; var ContainerPostFix = "_Container"; var VarPostfix = "_Var"; var AllNormalPostfix = "_AllNormal"; var ChandedPostfix = "_Changed"; var TemplateVarsPostfix = "_templateVars"; var TemplatePreparePostfix = "_templatePrepare"; var PlaceHolderPostfix = "_placeHolder"; var ChangedHiddenPostfix = "_changedHidden"; var TemplateSymbolPostfix = "_templateSymbol"; var LastIndexPostfix = "_lastIndex"; var DataGrid_ValidationTypePostfix = "_validationType"; var MinLastIndexPostfix = "_minLastIndex"; var LastVisibleIndexPostfix = "_lastVisibleIndex"; var TemplateEditHtmlPostfix = "_editHtml"; var TemplateDisplayHtmlPostfix = "_displayHtml"; var TemplateAllJavascriptPostfix = "_allJavascript"; var MvcControlsToolkit_DatagridCssPostfix = "_Css"; var MvcControlsToolkit_DatagridAltCssPostfix = "_AltCss"; var MvcControlsToolkit_DatagridFatherItemsPostfix = "_FatherItems"; function DataGrid_Field(b, c, a) { this.Original = b; this.Current = c; this.ValidationType = a } DataGrid_Field.prototype = { Original: null, Current: null, ValidationType: null, Reset: function () { if (this.Original == null) { return } if (this.Current == null) { return } if (this.Original.nodeName.toLowerCase() == "input") { if (this.Original.getAttribute("type").toLowerCase() == "checkbox" || this.Original.getAttribute("type").toLowerCase() == "radiobutton") { var a = this.Current.checked == this.Original.checked; this.Current.checked = this.Original.checked; if (!a) { $(this.Current).trigger("change") } } else { if (this.Original.getAttribute("type").toLowerCase() == "text" || this.Original.getAttribute("type").toLowerCase() == "password") { $(this.Current).trigger("focus"); this.Current.value = this.Original.value; $(this.Current).trigger("blur") } else { this.Current.value = this.Original.value } } } else { if (this.Original.nodeName.toLowerCase() == "textarea") { $(this.Current).trigger("focus"); this.Current.value = this.Original.value; $(this.Current).trigger("blur") } else { if (this.Original.nodeName.toLowerCase() == "select") { var a = (this.Current.value == this.Original.value); this.Current.value = this.Original.value; if (!a) { $(this.Current).trigger("change") } } } } MvcControlsToolkit_Validate(this.Current.id, this.ValidationType) } }; function DataGrid_EditRowFields(a) { this.Names = new Array(); this.Dictionary = new Array(); this.ValidationType = a } DataGrid_EditRowFields.prototype = { Names: null, Dictionary: null, ValidationType: null, AddOriginal: function (b, a) { if (typeof this.Dictionary[b] === "undefined") { this.Names.push(b); this.Dictionary[b] = new DataGrid_Field(a, null, this.ValidationType) } else { this.Dictionary[b].Original = a } }, AddCurrent: function (b, a) { if (typeof this.Dictionary[b] === "undefined") { this.Names.push(b); this.Dictionary[b] = new DataGrid_Field(null, a, this.ValidationType) } else { this.Dictionary[b].Current = a } }, Reset: function () { var b = null; for (var a = 0; a < this.Names.length; a++) { b = this.Names[a]; if (typeof this.Dictionary[b] !== "undefined") { this.Dictionary[b].Reset() } } } }; function DataGrid_ResetRow(itemRoot) { var fields = null; var temp = null; var validationType = null; var root = itemRoot.substring(0, itemRoot.lastIndexOf("___")); root = root.substring(0, root.lastIndexOf("___")); validationType = eval(root + DataGrid_ValidationTypePostfix); fields = eval(itemRoot + DatagridFielsdPostfix); if (fields == null) { fields = new DataGrid_EditRowFields(validationType); eval(itemRoot + DatagridFielsdPostfix + " = fields;"); temp = eval(itemRoot + SavePostFix); temp.find("input").each(function (i) { fields.AddOriginal(this.id, this) }); temp.find("textarea").each(function (i) { fields.AddOriginal(this.id, this) }); temp.find("select").each(function (i) { fields.AddOriginal(this.id, this) }); temp = eval(itemRoot + SavePostFixCurr); temp.find("input").each(function (i) { fields.AddCurrent(this.id, this) }); temp.find("textarea").each(function (i) { fields.AddCurrent(this.id, this) }); temp.find("select").each(function (i) { fields.AddCurrent(this.id, this) }); eval(itemRoot + SavePostFix + " = null;") } fields.Reset() } function DataGrid_Remove_Edit_Item(itemRoot) { var temp = null; temp = $("#" + itemRoot + EditPostfix + ContainerPostFix).detach(); if (temp.length != 0) { eval(itemRoot + SavePostFixCurr + " = temp;") } } function DataGrid_Display_Edit_Item(itemRoot) { var temp = null; temp = eval(itemRoot + SavePostFixCurr); $("#" + itemRoot + DisplayPostfix + ContainerPostFix).before(temp); DataGrid_ResetRow(itemRoot) } function DataGrid_ItemRoot_AtIndex(c, a) { var b = c.substring(c.lastIndexOf("___")); var d = c.substring(0, c.lastIndexOf("___")); d = d.substring(0, d.lastIndexOf("_") + 1); return d + a + b } function DataGrid_ItemRoot_Index(a) { a = a.substring(0, a.lastIndexOf("___")); a = a.substring(a.lastIndexOf("_") + 1); return parseInt(a) } function DataGrid_ChecKInsertNewItem(itemRoot) { var root = itemRoot.substring(0, itemRoot.lastIndexOf("___")); root = root.substring(0, root.lastIndexOf("___")); if (eval("typeof " + root + LastIndexPostfix + " === 'undefined'")) { return } var index = DataGrid_ItemRoot_Index(itemRoot); var visibleIndex = eval(root + LastVisibleIndexPostfix); if (index != visibleIndex) { return } var lastIndex = eval(root + LastIndexPostfix); if (lastIndex == index) { index++; var indexStr = index + ""; var templateSymbol = eval(root + TemplateSymbolPostfix); var displayTemplate = eval(root + TemplateDisplayHtmlPostfix).replace(templateSymbol, indexStr); var editTemplate = eval(root + TemplateEditHtmlPostfix).replace(templateSymbol, indexStr); var changed = $("<div>").append($("#" + eval(root + ChangedHiddenPostfix)).clone()).remove().html().replace(templateSymbol, indexStr); var placeHolderName = eval(root + PlaceHolderPostfix); var placeHolder = $("<div>").append($("#" + placeHolderName).clone()).remove().html().replace(templateSymbol, indexStr); var tableRoot = $("#" + itemRoot + EditPostfix + ContainerPostFix).parent(); $(displayTemplate).appendTo(tableRoot); $(editTemplate).appendTo(tableRoot); jQuery.globalEval(eval(root + TemplateAllJavascriptPostfix).replace(templateSymbol, indexStr)); var hiddenElementsFather = $("#" + placeHolderName).parent(); hiddenElementsFather.append(placeHolder); hiddenElementsFather.append(changed); var newItemName = DataGrid_ItemRoot_AtIndex(itemRoot, index) + EditPostfix + ContainerPostFix; if (typeof $ !== "undefined" && $ !== null && typeof $.validator !== "undefined" && $.validator !== null && typeof $.validator.unobtrusive !== "undefined" && $.validator.unobtrusive !== null) { jQuery.validator.unobtrusive.parseExt("#" + newItemName) } var initVars = eval(root + TemplateVarsPostfix).replace(templateSymbol, indexStr); jQuery.globalEval(initVars); var initCall = eval(root + TemplatePreparePostfix).replace(templateSymbol, indexStr); jQuery.globalEval(initCall); visibleIndex++; lastIndex++; eval(root + LastVisibleIndexPostfix + " = visibleIndex;"); eval(root + LastIndexPostfix + " = lastIndex;") } else { index++; var nextItem = DataGrid_ItemRoot_AtIndex(itemRoot, index); var temp = eval(nextItem + SavePostFixD); $("#" + nextItem + DisplayPostfix + ContainerPostFix).replaceWith(temp.clone(true)); eval(root + LastVisibleIndexPostfix + " = index;") } } function DataGrid_ChecKDisappearItem(itemRoot) { var root = itemRoot.substring(0, itemRoot.lastIndexOf("___")); root = root.substring(0, root.lastIndexOf("___")); if (eval("typeof  " + root + LastIndexPostfix + " === 'undefined'")) { return } var index = DataGrid_ItemRoot_Index(itemRoot); var visibleIndex = eval(root + LastVisibleIndexPostfix); var minIndex = eval(root + MinLastIndexPostfix); if (index < minIndex) { return } if (index != visibleIndex) { if (index == visibleIndex - 1) { index++; itemRoot = DataGrid_ItemRoot_AtIndex(itemRoot, index); DataGrid_ChecKDisappearItem(itemRoot); return } else { return } } if (index <= minIndex) { return } var display = $("#" + itemRoot + DisplayPostfix + ContainerPostFix); if (display.length == 0) { return } var prevItem = DataGrid_ItemRoot_AtIndex(itemRoot, index - 1); if ($("#" + prevItem + DisplayPostfix + ContainerPostFix).length == 0) { return } display.css("display", "none"); visibleIndex--; eval(root + LastVisibleIndexPostfix + " = visibleIndex"); index--; var prevtItem = DataGrid_ItemRoot_AtIndex(itemRoot, index); DataGrid_ChecKDisappearItem(prevItem, root) } function DataButton_Click(itemRoot, itemChanged, dataButtonType) { if (dataButtonType == DataButtonDelete) { var undel = eval(itemRoot + SavePostFixU); if (undel != null) { $("#" + itemRoot + DisplayPostfix + ContainerPostFix).before(undel.clone(true)); $("#" + itemRoot + DisplayPostfix + ContainerPostFix).remove() } else { $("#" + itemRoot + DisplayPostfix + ContainerPostFix).css("display", "none") } DataGrid_Remove_Edit_Item(itemRoot); $("#" + itemChanged).val("True"); eval(itemRoot + DeletedPostFix + " = true;") } else { if (dataButtonType == DataButtonEdit || dataButtonType == DataButtonInsert) { DataGrid_Display_Edit_Item(itemRoot); $("#" + itemRoot + DisplayPostfix + ContainerPostFix).remove(); $("#" + itemChanged).val("True"); DataGrid_ChecKInsertNewItem(itemRoot) } else { if (dataButtonType == DataButtonCancel) { var temp = eval(itemRoot + SavePostFixD); $("#" + itemRoot + EditPostfix + ContainerPostFix).before(temp.clone(true)); DataGrid_Remove_Edit_Item(itemRoot); $("#" + itemChanged).val("False"); DataGrid_ChecKDisappearItem(itemRoot) } else { if (dataButtonType == DataButtonResetRow) { var temp = eval(itemRoot + SavePostFixD); $("#" + itemRoot + EditPostfix + ContainerPostFix).before(temp.clone(true)); DataGrid_Remove_Edit_Item(itemRoot); DataGrid_Display_Edit_Item(itemRoot); $("#" + itemRoot + DisplayPostfix + ContainerPostFix).remove() } else { if (dataButtonType == DataButtonUndelete) { var undel = eval(itemRoot + SavePostFixU); var temp = eval(itemRoot + SavePostFixD); if (undel != null) { $("#" + itemRoot + UndeletePostfix + ContainerPostFix).before(temp.clone(true)); $("#" + itemRoot + UndeletePostfix + ContainerPostFix).remove() } else { $("#" + itemRoot + DisplayPostfix + ContainerPostFix).replaceWith(temp.clone(true)) } eval(itemRoot + DeletedPostFix + " = false;"); $("#" + itemChanged).val("False") } } } } } MvcControlsToolkit_DataGridApplyStylesItem(itemRoot) } function DataGrid_Prepare_Template(itemRoot, itemChanged, deleted, root) { var allJavascript = CollectAllScriptsInelement(itemRoot + EditPostfix + ContainerPostFix) + CollectAllScriptsInelement(itemRoot + DisplayPostfix + ContainerPostFix); eval(root + TemplateAllJavascriptPostfix + " = allJavascript;"); var editTemplateElement = $("#" + itemRoot + EditPostfix + ContainerPostFix); var displayTemplateElement = $("#" + itemRoot + DisplayPostfix + ContainerPostFix); editTemplateElement.find("script").remove(); displayTemplateElement.find("script").remove(); var temp = null; if (editTemplateElement.hasClass("MVCCT_EncodedTemplate")) { temp = editTemplateElement.text() } else { temp = $("<div>").append(editTemplateElement.clone()).remove().html() } eval(root + TemplateEditHtmlPostfix + " = temp;"); if (displayTemplateElement.hasClass("MVCCT_EncodedTemplate")) { temp = displayTemplateElement.text() } else { temp = $("<div>").append(displayTemplateElement.clone()).remove().html() } eval(root + TemplateDisplayHtmlPostfix + " = temp;"); editTemplateElement.remove(); displayTemplateElement.remove() } function MvcControlsToolkit_DataGridApplyStylesItem(b) { var a = b.substring(0, b.lastIndexOf("___")); a = a.substring(0, a.lastIndexOf("___")); MvcControlsToolkit_DataGridApplyStyles(a) } function MvcControlsToolkit_DataGridApplyStyles(rootName) { var root = eval(rootName + MvcControlsToolkit_DatagridFatherItemsPostfix); if (root == null) { return } var css = eval(rootName + MvcControlsToolkit_DatagridCssPostfix); var altCss = eval(rootName + MvcControlsToolkit_DatagridAltCssPostfix); var alt = false; for (i = 0; i < root.childNodes.length; i++) { var nodeId = root.childNodes[i].id; if (nodeId == null) { continue } var end_prefix = nodeId.lastIndexOf("_"); if (end_prefix < 0) { continue } var ending = nodeId.substring(end_prefix); if (ending != ContainerPostFix) { continue } if ($(root.childNodes[i]).css("display") == "none") { continue } if (alt) { if (css != "") { $(root.childNodes[i]).removeClass(css) } if (altCss != "") { $(root.childNodes[i]).addClass(altCss) } } else { if (altCss != "") { $(root.childNodes[i]).removeClass(altCss) } if (css != "") { $(root.childNodes[i]).addClass(css) } } alt = !alt } } function DataGrid_Prepare_Item(itemRoot, itemChanged, deleted, root) { var temp = eval(root + AllNormalPostfix); if (temp == null) { temp = new Array() } temp.push(itemRoot); eval(root + AllNormalPostfix + " = temp"); temp = $("#" + itemRoot + OldEditPostfix + ContainerPostFix).find("script").remove(); temp = $("#" + itemRoot + OldEditPostfix + ContainerPostFix).detach(); $("#" + itemRoot + EditPostfix + ContainerPostFix).find("script").remove(); if (temp.length == 0) { temp = $("#" + itemRoot + EditPostfix + ContainerPostFix).clone(true) } eval(itemRoot + SavePostFix + " = temp;"); temp = $("#" + itemRoot + DisplayPostfix + ContainerPostFix); temp.find("script").remove(); var parent = temp.parent(); if (parent.length > 0) { parent = parent[0]; eval(root + MvcControlsToolkit_DatagridFatherItemsPostfix + " = parent;") } temp = temp.clone(true); eval(itemRoot + SavePostFixD + " = temp;"); temp = $("#" + itemRoot + ChangedExternallyPostfix + ContainerPostFix).find("script").remove(); temp = temp.clone(true); if (temp != null && temp.size() == 0) { temp = null } eval(itemRoot + SavePostFixC + " = temp;"); $("#" + itemRoot + ChangedExternallyPostfix + ContainerPostFix).remove(); temp = $("#" + itemRoot + UndeletePostfix + ContainerPostFix).find("script").remove(); temp = temp.clone(true); if (temp != null && temp.size() == 0) { temp = null } eval(itemRoot + SavePostFixU + " = temp;"); if (deleted) { DataGrid_Remove_Edit_Item(itemRoot); if (temp == null) { $("#" + itemRoot + DisplayPostfix + ContainerPostFix).css("display", "none") } else { $("#" + itemRoot + DisplayPostfix + ContainerPostFix).remove() } eval(itemRoot + DeletedPostFix + " = true;") } else { $("#" + itemRoot + UndeletePostfix + ContainerPostFix).remove(); if (eval(itemChanged + VarPostfix)) { DataGrid_Remove_Edit_Item(itemRoot) } else { $("#" + itemRoot + DisplayPostfix + ContainerPostFix).remove() } eval(itemRoot + DeletedPostFix + " = false;") } } var SortableList_PermutationUpdateRootPrefix = "_PermutationUpdateRoot"; var SortableList_CanSortPrefix = "_CanSort"; var SortableList_ElementsNumberPrefix = "_ElementsNumber"; var SortableList_TemplateSymbolPrefix = "_TemplateSymbol"; var SortableList_TemplateSriptPrefix = "_TemplateSript"; var SortableList_TemplateHtmlPrefix = "_TemplateHtml"; var SortableList_PermutationPrefix = "_Permutation"; var SortableList_PermutationNamePrefix = ".Permutation"; var SortableList_UpdateModelPrefix = "___"; var SortableList_UpdateModelNamePrefix = ".$$"; var SortableList_UpdateModelFieldsPrefix = "_f_ields"; var SortableList_UpdateModelFieldsNamePrefix = ".f$ields"; var SortableList_ItemsContainerPrefix = "_ItemsContainer"; var SortableList_OriginalElementsNumber = "_OriginalElementsNumber"; var SortableList_TemplateHiddenPrefix = "_TemplateHidden"; var SortableList_TemplateHiddenHtmlPrefix = "_TemplateHiddenHtml"; var SortableList_NamePrefixPrefix = "_NamePrefix"; var SortableList_CssPostFix = "_Css"; var SortableList_AltCssPostFix = "_AltCss"; function MvcControlsToolkit_SortableList_PrepareTemplate(a, b) { MvcControlsToolkit_SortableList_PrepareTemplates(a, [b]) } function MvcControlsToolkit_SortableList_PrepareTemplates(root, templatesId) { eval(root + SortableList_TemplateSriptPrefix + " = new Array();"); eval(root + SortableList_TemplateHtmlPrefix + " = new Array();"); eval(root + SortableList_TemplateHiddenHtmlPrefix + " = new Array();"); for (var i = 0; i < templatesId.length; i++) { var templateId = templatesId[i]; var templateElement = $("#" + templateId); var allJavascript = CollectAllScriptsInelement(templateId); eval(root + SortableList_TemplateSriptPrefix + "[i] = allJavascript;"); $("#" + templateId).find("script").remove(); var temp = null; if (templateElement.hasClass("MVCCT_EncodedTemplate")) { temp = templateElement.text() } else { temp = $("<div>").append(templateElement.clone()).remove().html() } eval(root + SortableList_TemplateHtmlPrefix + "[i] = temp;"); var hidden = eval(root + SortableList_TemplateHiddenPrefix); if (hidden.constructor == Array) { hidden = eval(root + SortableList_TemplateHiddenPrefix + "[i]") } temp = $("<div>").append($("#" + hidden).clone()).remove().html(); eval(root + SortableList_TemplateHiddenHtmlPrefix + "[i] = temp;"); $("#" + templateId).remove() } var canSort = eval(root + SortableList_CanSortPrefix); if (canSort) { var elementNumber = eval(root + SortableList_ElementsNumberPrefix); var updateModel = document.getElementById(root + SortableList_UpdateModelPrefix + elementNumber); updateModel.setAttribute("id", updateModel.id + "_"); var updateModelFields = document.getElementById(root + SortableList_UpdateModelPrefix + elementNumber + SortableList_UpdateModelFieldsPrefix); updateModelFields.setAttribute("id", updateModelFields.id + "_") } } function MvcControlsToolkit_SortableList_AddNew(a, b) { MvcControlsToolkit_SortableList_AddNewChoice(a, 0, b) } function MvcControlsToolkit_SortableList_AddNewChoice(root, choice, item) { if (eval("typeof  " + root + SortableList_ElementsNumberPrefix + " === 'undefined'")) { return } var elementNumber = eval(root + SortableList_ElementsNumberPrefix); var originalElementNumber = eval(root + SortableList_OriginalElementsNumber); var templateSymbol = eval(root + SortableList_TemplateSymbolPrefix); if (templateSymbol.constructor == Array) { templateSymbol = eval(root + SortableList_TemplateSymbolPrefix + "[choice]") } var hidden = eval(root + SortableList_TemplateHiddenPrefix); if (hidden.constructor == Array) { hidden = eval(root + SortableList_TemplateHiddenPrefix + "[choice]") } var allJavascript = eval(root + SortableList_TemplateSriptPrefix + "[choice]").replace(templateSymbol, elementNumber + ""); var allHtml = eval(root + SortableList_TemplateHtmlPrefix + "[choice]").replace(templateSymbol, elementNumber + ""); var hiddenElementFather = $("#" + hidden).parent(); var hiddenElement = eval(root + SortableList_TemplateHiddenHtmlPrefix + "[choice]").replace(templateSymbol, elementNumber + ""); var canSort = eval(root + SortableList_CanSortPrefix); var namePrefix = eval(root + SortableList_NamePrefixPrefix); elementNumber++; eval(root + SortableList_ElementsNumberPrefix + " = elementNumber;"); if (canSort) { var permutation = document.getElementById(root + SortableList_PermutationPrefix); permutation.setAttribute("name", namePrefix + SortableList_UpdateModelNamePrefix + elementNumber + ".$" + SortableList_PermutationNamePrefix); var updateModel = document.getElementById(root + SortableList_UpdateModelPrefix + originalElementNumber + "_"); updateModel.setAttribute("name", namePrefix + SortableList_UpdateModelNamePrefix + elementNumber); var updateModelFields = document.getElementById(root + SortableList_UpdateModelPrefix + originalElementNumber + SortableList_UpdateModelFieldsPrefix + "_"); updateModelFields.setAttribute("name", namePrefix + SortableList_UpdateModelNamePrefix + elementNumber + SortableList_UpdateModelFieldsNamePrefix) } hiddenElementFather.append(hiddenElement); var result; if (item == null) { var hasFooter = false; var lastChild = $("#" + root + "_Footer"); if (lastChild.length > 0) { hasFooter = true } if (hasFooter) { result = $(allHtml).insertBefore(lastChild) } else { result = $(allHtml).appendTo("#" + root + SortableList_ItemsContainerPrefix) } } else { result = $(allHtml).insertBefore(item); MvcControlsToolkit_Bind(item, result[0]); $(item).remove() } if (typeof $ !== "undefined" && $ !== null && typeof $.validator !== "undefined" && $.validator !== null && typeof $.validator.unobtrusive !== "undefined" && $.validator.unobtrusive !== null) { jQuery.validator.unobtrusive.parseExt("#" + result[0].id) } jQuery.globalEval(allJavascript); Update_Permutations_Root(root); if (canSort) { $("#" + root + SortableList_ItemsContainerPrefix).sortable("refresh") } return result } function Update_Permutations(b) { var a = b.lastIndexOf("___"); if (a < 0) { return } var c = b.substring(0, a); a = c.lastIndexOf("___"); c = c.substring(0, a); if (a < 0) { return } return Update_Permutations_Root(c) } function Update_Permutations_Root(rootName) { var root = document.getElementById(rootName + "_ItemsContainer"); if (root == null) { return } if (root.childNodes.length > 0 && root.childNodes[root.childNodes.length - 1].id == "") { root = root.childNodes[root.childNodes.length - 1] } var field = document.getElementById(rootName + "_Permutation"); var alt = false; var css = eval(rootName + SortableList_CssPostFix); var altCss = eval(rootName + SortableList_AltCssPostFix); for (i = 0; i < root.childNodes.length; i++) { var nodeId = root.childNodes[i].getAttribute("id"); if (nodeId == null) { continue } var end_prefix = nodeId.lastIndexOf("_"); if (end_prefix < 0) { continue } var ending = nodeId.substring(end_prefix + 1); if (ending == "Header" || ending == "Footer") { continue } if (alt) { if (css != "") { $(root.childNodes[i]).removeClass(css) } if (altCss != "") { $(root.childNodes[i]).addClass(altCss) } } else { if (altCss != "") { $(root.childNodes[i]).removeClass(altCss) } if (css != "") { $(root.childNodes[i]).addClass(css) } } alt = !alt } if (field == null) { return } var res = ""; for (i = 0; i < root.childNodes.length; i++) { var nodeId = root.childNodes[i].getAttribute("id"); var end_prefix = nodeId.lastIndexOf("_"); if (end_prefix < 0) { continue } var deleteName = nodeId.substring(0, end_prefix + 1) + "Deleted"; var deletedHidden = document.getElementById(deleteName); if (deletedHidden != null && deletedHidden.value == "True") { continue } var end = nodeId.lastIndexOf("___"); var order = nodeId.substring(0, end); var start = order.lastIndexOf("_") + 1; order = order.substring(start); if (i > 0) { res = res + "," } res = res + order } field.value = res } var ManipulationButtonRemove = "ManipulationButtonRemove"; var ManipulationButtonHide = "ManipulationButtonHide"; var ManipulationButtonShow = "ManipulationButtonShow"; var ManipulationButtonResetGrid = "ManipulationButtonResetGrid"; var ManipulationButtonCustom = "ManipulationButtonCustom"; function ManipulationButton_Click(target, dataButtonType) { if (dataButtonType == ManipulationButtonCustom) { eval(target); return } var end_prefix = target.lastIndexOf("_"); var deleteName = target.substring(0, end_prefix); end_prefix = deleteName.lastIndexOf("_"); deleteName = deleteName.substring(0, end_prefix + 1) + "Deleted"; var deletedHidden = document.getElementById(deleteName); if (dataButtonType == ManipulationButtonRemove) { $("#" + target).remove(); Update_Permutations(target) } else { if (dataButtonType == ManipulationButtonHide) { $("#" + target).css("visibility", "hidden"); if (deletedHidden != null) { deletedHidden.value = "True" } Update_Permutations(target) } else { if (dataButtonType == ManipulationButtonShow) { $("#" + target).css("visibility", "visible"); if (deletedHidden != null) { deletedHidden.value = "False" } Update_Permutations(target) } else { if (dataButtonType == ManipulationButtonResetGrid) { var toUndo = eval(target + AllNormalPostfix); if (toUndo != null) { for (var i = 0; i < toUndo.length; i++) { var vChanged = toUndo[i].substring(0, toUndo[i].lastIndexOf("_")) + ChandedPostfix; var deleted = eval(toUndo[i] + DeletedPostFix); if (deleted != null && deleted == true) { DataButton_Click(toUndo[i], vChanged, DataButtonUndelete) } else { DataButton_Click(toUndo[i], vChanged, DataButtonCancel) } } } } } } } } function MvcControlsToolkit_Button_AdjustText(a, c) { var b = document.getElementById(a); var d = b.nodeName.toLowerCase(); if (d == "input") { b.value = c } else { if (d == "img") { b.setAttribute("src", c) } else { if (d == "a") { b.firstChild.nodeValue = c } } } } var MvcControlsToolkit_TreeView_ButtonModePostfix = "_ButtonMode"; var MvcControlsToolkit_TreeView_SaveDisplayPostfix = "_SaveDisplay"; var MvcControlsToolkit_TreeView_SaveEditPostfix = "_SaveEdit"; var MvcControlsToolkit_TreeView_ContainerDisplayPostfix = "___Choice1___flattened_ItemsContainer"; var MvcControlsToolkit_TreeView_ContainerEditPostfix = "___Choice2___flattened_ItemsContainer"; var MvcControlsToolkit_TreeView_ToggleEditPostfix = "_ToggleEditButton"; var MvcControlsToolkit_TreeView_IsEditPostFix = "___IsChoice2"; var MvcControlsToolkit_TreeView_RootNamePostfix = "_RootNamePostfix"; var MvcControlsToolkit_TreeView_ClosedPostfix = "___Closed"; var MvcControlsToolkit_TreeView_ItemsCountPostfix = "___ItemsCount"; var MvcControlsToolkit_TreeView_TemplatesPostfix = "_Templates"; function MvcControlsToolkit_TreeView_StartDrag(e, d) { var b = true; var a = d.attr("class"); if (a != null) { var a = a.split(" "); if (a != null && a.length > 0) { a = a[0]; if (a != null && a.length > 0 && a.substring(a.length - 1) != "_") { return } else { a = a.substring(0, a.length - 1); var f = $("." + a); if (f.length > 0) { var c = MvcControlsToolkit_FormContext$_isElementInHierarchy(e[0], f[0]); if (c) { f.removeClass(a); f.attr("class", a + "__ " + f.attr("class")) } } } } } d.sortable("option", "items", ""); d.sortable("refresh") } function MvcControlsToolkit_TreeView_StopDrag(c, b) { var a = b.attr("class"); if (a != null) { var a = a.split(" "); if (a != null && a.length > 0) { a = a[0]; if (a != null && a.length > 0 && a.substring(a.length - 1) == "_") { a = a + "_" } else { a = a + "__" } var d = $("." + a); if (d.length > 0) { d.removeClass(a); a = a.substring(0, a.length - 2); d.attr("class", a + " " + d.attr("class")) } } } b.sortable("option", "items", "> *"); b.sortable("refresh") } function MvcControlsToolkit_TreeView_SelectLevel(f, b) { var c = $(f).parent().find(">ul"); var d = c.attr("class"); var a = null; if (d != null) { var a = d.split(" "); if (a != null && a.length > 0) { d = a[0] } else { a = new Array(); a.push(d) } d = a[0] } if (f.checked) { if (d != null && d.length > 0 && d.substring(d.length - 1) == "_") { d = d.substring(0, d.length - 1) } } else { if (d != null && d.length > 0 && d.substring(d.length - 1) != "_") { d = d + "_" } } for (var e = 1; e < a.length; e++) { d = d + " " + a[e] } c.attr("class", d); if (f.checked) { $(b).each(function () { if (this == f) { return } if (!this.checked) { return } this.checked = false; MvcControlsToolkit_TreeView_SelectLevel(this, b) }) } } function MvcControlsToolkit_TreeView_PrepareTemplates(root, templatesId) { eval(root + SortableList_TemplateSriptPrefix + " = new Array();"); eval(root + SortableList_TemplateHtmlPrefix + " = new Array();"); for (var i = 0; i < templatesId.length; i++) { var templateId = templatesId[i]; var templateElement = $("#" + templateId); var allJavascript = CollectAllScriptsInelement(templateId); eval(root + SortableList_TemplateSriptPrefix + "[i] = allJavascript;"); templateElement.find("script").remove(); var temp = null; if (templateElement.hasClass("MVCCT_EncodedTemplate")) { temp = templateElement.text() } else { temp = $("<div>").append(templateElement.children().clone()).remove().html() } eval(root + SortableList_TemplateHtmlPrefix + "[i] = temp;") } $("#" + root + MvcControlsToolkit_TreeView_TemplatesPostfix).remove() } function MvcControlsToolkit_TreeView_AddNewChoice(rootName, templateChosen) { if (eval("typeof  " + rootName + MvcControlsToolkit_TreeView_RootNamePostfix + " === 'undefined'")) { return } var root = eval(rootName + MvcControlsToolkit_TreeView_RootNamePostfix); var elementNumber = parseInt(document.getElementById(root + MvcControlsToolkit_TreeView_ItemsCountPostfix).value); templateSymbol = eval(root + SortableList_TemplateSymbolPrefix) + templateChosen; var allJavascript = eval(root + SortableList_TemplateSriptPrefix + "[templateChosen]").replace(templateSymbol, elementNumber + ""); var allHtml = eval(root + SortableList_TemplateHtmlPrefix + "[templateChosen]").replace(templateSymbol, elementNumber + ""); var canSort = eval(root + SortableList_CanSortPrefix); document.getElementById(root + MvcControlsToolkit_TreeView_ItemsCountPostfix).value = (elementNumber + 1) + ""; var result = $(allHtml).appendTo("#" + rootName + SortableList_ItemsContainerPrefix); var initFields = result.find(".MvcCT_init_info_" + root).detach().children(); initFields.insertAfter("#" + root + SortableList_ItemsContainerPrefix); result.find(".level-select_" + root).change(function (event) { MvcControlsToolkit_TreeView_SelectLevel(event.target, ".level-select_" + root) }); jQuery.globalEval(allJavascript); if (typeof $ !== "undefined" && $ !== null && typeof $.validator !== "undefined" && $.validator !== null && typeof $.validator.unobtrusive !== "undefined" && $.validator.unobtrusive !== null) { jQuery.validator.unobtrusive.parseExt("#" + result[0].id) } $("#" + root + SortableList_ItemsContainerPrefix).treeview({ add: result }); MvcControlsToolkit_TreeView_UpdateFather(result[0], rootName + SortableList_ItemsContainerPrefix); if (canSort) { $("#" + rootName + SortableList_ItemsContainerPrefix).sortable("refresh") } return result } function MvcControlsToolkit_TreeViewToggle(b) { if (b == null) { return } var a = b.id.substring(0, b.id.lastIndexOf("_")) + MvcControlsToolkit_TreeView_ClosedPostfix; var c = document.getElementById(a); if (c == null) { return } c.value = $(b).hasClass($.treeview.classes.expandable) ? "True" : "False" } function MvcControlsToolkit_TreeView_UpdatePermutations(b) { if (b == null || b.length == 0) { return } var d = b.attr("id"); if (d == null) { return } var a = d.lastIndexOf("_"); if (a < 0) { return } d = d.substring(0, a); var c = document.getElementById(d + "___FatherOriginalId"); MvcControlsToolkit_TreeView_UpdateFather(b[0], c.value.replace(/[\$\.]/g, "_") + SortableList_ItemsContainerPrefix); MvcControlsToolkit_TreeView_UpdateFather(b[0], null) } function MvcControlsToolkit_TreeView_AdjustToggleButton(id, textOrUrlEdit, cssClassEdit, textOrUrlUndoEdit, cssClassUndoEdit, textOrUrlRedoEdit, cssClassRedoEdit) { var button = $("#" + id + MvcControlsToolkit_TreeView_ToggleEditPostfix); if (button.length == 0) { return } if (eval("typeof " + id + MvcControlsToolkit_TreeView_ButtonModePostfix + " === 'undefined'")) { return } var buttonMode = eval(id + MvcControlsToolkit_TreeView_ButtonModePostfix); if (buttonMode == 0) { button.removeClass(cssClassUndoEdit); button.removeClass(cssClassRedoEdit); button.addClass(cssClassEdit); MvcControlsToolkit_Button_AdjustText(id + MvcControlsToolkit_TreeView_ToggleEditPostfix, textOrUrlEdit) } else { if (buttonMode == 1) { button.removeClass(cssClassUndoEdit); button.removeClass(cssClassEdit); button.addClass(cssClassRedoEdit); MvcControlsToolkit_Button_AdjustText(id + MvcControlsToolkit_TreeView_ToggleEditPostfix, textOrUrlRedoEdit) } else { button.removeClass(cssClassRedoEdit); button.removeClass(cssClassEdit); button.addClass(cssClassUndoEdit); MvcControlsToolkit_Button_AdjustText(id + MvcControlsToolkit_TreeView_ToggleEditPostfix, textOrUrlUndoEdit) } } } function MvcControlsToolkit_TreeView_ToggleEdit(id, textOrUrlEdit, cssClassEdit, textOrUrlUndoEdit, cssClassUndoEdit, textOrUrlRedoEdit, cssClassRedoEdit) { if (eval("typeof " + id + MvcControlsToolkit_TreeView_ButtonModePostfix + " === 'undefined'")) { return } var buttonMode = eval(id + MvcControlsToolkit_TreeView_ButtonModePostfix); if (buttonMode == 0 || buttonMode == 1) { var edit = eval(id + MvcControlsToolkit_TreeView_SaveEditPostfix); $("#" + id + MvcControlsToolkit_TreeView_ContainerDisplayPostfix).before(edit); var display = $("#" + id + MvcControlsToolkit_TreeView_ContainerDisplayPostfix).detach(); eval(id + MvcControlsToolkit_TreeView_SaveDisplayPostfix + " = display;"); eval(id + MvcControlsToolkit_TreeView_ButtonModePostfix + " = 2;"); document.getElementById(id + MvcControlsToolkit_TreeView_IsEditPostFix).value = "True" } else { var display = eval(id + MvcControlsToolkit_TreeView_SaveDisplayPostfix); $("#" + id + MvcControlsToolkit_TreeView_ContainerEditPostfix).before(display); var edit = $("#" + id + MvcControlsToolkit_TreeView_ContainerEditPostfix).detach(); eval(id + MvcControlsToolkit_TreeView_SaveEditPostfix + " = edit;"); eval(id + MvcControlsToolkit_TreeView_ButtonModePostfix + " = 1;"); document.getElementById(id + MvcControlsToolkit_TreeView_IsEditPostFix).value = "False" } MvcControlsToolkit_TreeView_AdjustToggleButton(id, textOrUrlEdit, cssClassEdit, textOrUrlUndoEdit, cssClassUndoEdit, textOrUrlRedoEdit, cssClassRedoEdit) } function MvcControlsToolkit_TreeView_UpdateFather(q, g) { if (q == null && g == null) { return } var l = null; var o = g; if (o == null) { l = q.parentNode; o = l.getAttribute("id") } else { l = document.getElementById(o) } var e = o.lastIndexOf("_"); if (e < 0) { return } var m = o.substring(0, e); var r = m + "_handle"; var b = document.getElementById(m + "___SonNumber"); if (b == null) { return } b.value = l.childNodes.length + ""; var s = document.getElementById(m + "___OriginalId"); if (s == null) { return } var c = s.value; var a = null; var j = null; var d = null; for (i = 0; i < l.childNodes.length; i++) { var h = l.childNodes[i].getAttribute("id"); e = h.lastIndexOf("_"); if (e < 0) { continue } a = h.substring(0, e); j = document.getElementById(a + "___PositionAsSon"); j.value = i + ""; d = document.getElementById(a + "___FatherOriginalId"); d.value = c; if (l.childNodes[i] == q) { e = q.id.lastIndexOf("_"); var p = $(document.getElementById(q.id.substring(0, e) + "___Item_SubContainer")); if (!p.hasClass(r)) { p.removeClass(); p.addClass(r) } var k = $(q); if (i != l.childNodes.length - 1) { k.removeClass($.treeview.classes.last).removeClass($.treeview.classes.lastCollapsable).removeClass($.treeview.classes.lastExpandable).find(">.hitarea").replaceClass($.treeview.classes.lastCollapsableHitarea, $.treeview.classes.collapsableHitarea).replaceClass($.treeview.classes.lastExpandableHitarea, $.treeview.classes.expandableHitarea) } } } if (l.childNodes.length > 0) { var f = $(l.childNodes[l.childNodes.length - 1]); if (!f.hasClass($.treeview.classes.last)) { f.addClass($.treeview.classes.last).filter("." + $.treeview.classes.expandable).replaceClass($.treeview.classes.last, $.treeview.classes.lastExpandable).end().find(">.hitarea").replaceClass($.treeview.classes.expandableHitarea, $.treeview.classes.lastExpandableHitarea).end().filter("." + $.treeview.classes.collapsable).replaceClass($.treeview.classes.last, $.treeview.classes.lastCollapsable).end().find(">.hitarea").replaceClass($.treeview.classes.collapsableHitarea, $.treeview.classes.lastCollapsableHitarea) } } if (l.childNodes.length > 1) { var n = $(l.childNodes[l.childNodes.length - 2]); n.removeClass($.treeview.classes.last).removeClass($.treeview.classes.lastCollapsable).removeClass($.treeview.classes.lastExpandable).find(">.hitarea").replaceClass($.treeview.classes.lastCollapsableHitarea, $.treeview.classes.collapsableHitarea).replaceClass($.treeview.classes.lastExpandableHitarea, $.treeview.classes.expandableHitarea) } } function MvcControlsToolkit_TreeView_AddNew(d, b) { var a = d.lastIndexOf("___"); if (a < 0) { return } var d = d.substring(0, a); var c = MvcControlsToolkit_TreeView_AddNewChoice(d, b) } function MvcControlsToolkit_TreeView_Delete(c) { var a = c.lastIndexOf("___"); if (a < 0) { return } var c = c.substring(0, a); var b = document.getElementById(c + ContainerPostFix); var d = document.getElementById(c + "___FatherOriginalId"); $(b).remove(); MvcControlsToolkit_TreeView_UpdateFather(b, d.value.replace(/[\$\.]/g, "_") + SortableList_ItemsContainerPrefix) } function PageButton_Click(d, c, e, b, a) { if (e == "") { if (!MvcControlsToolkit_FormIsValid(d, a)) { return } var f = document.getElementById(d); f.value = c; $("#" + d).parents("form").submit() } else { if (b != "") { $.ajax({ type: "GET", url: e, success: function (g) { $("#" + b).html(g) } }) } else { window.location.href = e } } } function Sort_Handler(field, buttonName, initialize, causePostback, clientOrderChanged, sortField, pageField, cssNoSort, cssAscending, cssDescending, validationType) { if (!initialize && causePostback && !MvcControlsToolkit_FormIsValid(sortField, validationType)) { return } var order = $("#" + sortField).val(); var hasAscending = order.indexOf(" " + field + "#+;"); var hasDescending = order.indexOf(" " + field + "#-;"); var prevOrder = ""; var actualOrder = ""; if (!initialize) { if (hasDescending >= 0) { order = order.replace(" " + field + "#-;", ""); $("#" + sortField).val(order); $("#" + buttonName).removeClass(cssDescending); $("#" + buttonName).addClass(cssNoSort); prevOrder = "-" } else { if (hasAscending >= 0) { order = order.replace(" " + field + "#+;", " " + field + "#-;"); $("#" + sortField).val(order); $("#" + buttonName).removeClass(cssAscending); $("#" + buttonName).addClass(cssDescending); prevOrder = "+"; actualOrder = "-" } else { order = order + " " + field + "#+;"; $("#" + sortField).val(order); $("#" + buttonName).removeClass(cssNoSort); $("#" + buttonName).addClass(cssAscending); actualOrder = "+" } } if (pageField != null) { $("#" + pageField).val("1") } if (clientOrderChanged != null) { eval(clientOrderChanged + "('" + field + "', '" + prevOrder + "', '" + actualOrder + "')") } if (causePostback) { $("#" + sortField).parents("form").submit() } } else { if (hasDescending >= 0) { $("#" + buttonName).addClass(cssDescending) } else { if (hasAscending >= 0) { $("#" + buttonName).addClass(cssAscending) } else { $("#" + buttonName).addClass(cssNoSort) } } } } function Setup_Ajax_ClientValidation(d, a) { if (a == ValidationType_StandardClient) { var e = window.mvcClientValidationMetadata; if (e) { for (var b = 0; b < e.length; b++) { var c = e[b]; c.FormId = d } } Sys.Mvc.FormContext._Application_Load() } else { if (typeof $ !== "undefined" && $ !== null && typeof $.validator !== "undefined" && $.validator !== null && typeof $.validator.unobtrusive !== "undefined" && $.validator.unobtrusive !== null) { $.validator.unobtrusive.clearAndParse("#" + d) } } } function OnBeginDetailForm(baseName, detailType, rowId, loadingElementId, validationType) { detailBusy = eval(baseName + "_DetailBusy"); if (detailBusy) { return false } eval(baseName + "_DetailBusy = true;"); eval(baseName + "_TypeDetail = '" + detailType + "';"); if (rowId != null) { if (detailType == "Insert") { eval(baseName + "_CurrentRow = null;") } else { eval(baseName + "_CurrentRow = '" + rowId + "';") } } else { var res = MvcControlsToolkit_FormIsValid(loadingElementId, validationType); return res } return true } function OnFailureDetailForm(baseName, displayExecute, editExecute) { var detailType = eval(baseName + "_TypeDetail"); if (detailType == "Display") { if (displayExecute != null) { (displayExecute + "();") } } else { if (editExecute != null) { (editExecute + "();") } } eval(baseName + "_DetailBusy = false;") } function TrueValue(value, fieldName) { var trueValue = value; try { trueValue = eval(fieldName + "_True") } catch (e) { } return trueValue } function FormattedValue(value, fieldName) { var fValue = value; try { fValue = eval(fieldName + "_Format") } catch (e) { } var companionField = document.getElementById(fieldName + "_hidden"); if (companionField != null) { fValue = companionField.value } return fValue } function OnSuccessDetailForm(baseName, displayExecute, editExecute, ajaxContext, formId, validationType, unobtrusiveAjaxOn, updateTargetId) { if (!unobtrusiveAjaxOn) { GlobalEvalScriptInElementId(ajaxContext.get_updateTarget()) } else { $("#" + updateTargetId).html(ajaxContext) } if (validationType != ValidationType_Server) { Setup_Ajax_ClientValidation(formId, validationType) } var detailType = eval(baseName + "_TypeDetail"); var changedFieldCss = eval(baseName + "_ChangedFieldCss"); var deletedRecordCss = eval(baseName + "_DeletedRecordCss"); var isValid = false; var hiddenIsValid = document.getElementById("IsValid"); if (hiddenIsValid != null && hiddenIsValid.value == "True") { isValid = true } if (isValid && (detailType == "FirstEdit" || detailType == "Edit" || detailType == "Display")) { var itemRoot = eval(baseName + "_CurrentRow"); var fieldsToUpdate = eval(baseName + "_FieldsToUpdate").split(","); var detailRoot = eval(baseName + "_DetailPrefix"); if (itemRoot != null) { var oldItemRoot = itemRoot.substring(0, itemRoot.lastIndexOf("Value")) + "OldValue"; var isInsert = true; var isExternalDelete = true; var changedDisplay = eval(itemRoot + SavePostFixC); var changedDisplayAvailable = false; if (changedDisplay == null) { changedDisplay = eval(itemRoot + SavePostFixD) } else { changedDisplayAvailable = true } for (var i = 0; i < fieldsToUpdate.length; i++) { var oldField = document.getElementById(oldItemRoot + "_" + fieldsToUpdate[i]); if (oldField != null) { isInsert = false } var newFieldName = null; if (detailRoot.length == 0) { newFieldName = fieldsToUpdate[i] } else { newFieldName = oldItemRoot + "_" + fieldsToUpdate[i] } var newField = document.getElementById(newFieldName); if (newField != null) { isExternalDelete = false } if (oldField != null) { var newValue = null; var newFormattedValue = null; if (newField != null && newField.getAttribute("type") != null && (newField.getAttribute("type").toLowerCase() == "checkbox" || newField.getAttribute("type").toLowerCase() == "radiobutton")) { if (newField.getAttribute("checked") != null && newField.checked == true) { newValue = "True" } else { newValue = "False" } } else { if (newField != null) { if (newField.nodeName != null && (newField.nodeName.toLowerCase() == "input" || newField.nodeName.toLowerCase() == "textarea" || newField.nodeName.toLowerCase() == "select")) { newValue = TrueValue(newField.value, newFieldName); newFormattedValue = FormattedValue(newField.value, newFieldName) } else { newValue = TrueValue(newField.childNodes(0).nodeValue, newFieldName); newFormattedValue = FormattedValue(newField.childNodes(0).nodeValue, newFieldName) } } else { newValue = TrueValue(null, newFieldName); newFormattedValue = FormattedValue(null, newFieldName) } } var itemToUpdate = changedDisplay.find("#" + itemRoot + "_" + fieldsToUpdate[i]); if (changedFieldCss != null) { if (newValue != null && oldField.value != newValue) { itemToUpdate.addClass(changedFieldCss) } else { itemToUpdate.removeClass(changedFieldCss) } } if (newValue != null && oldField.value != newValue) { oldField.value = newValue; if (itemToUpdate.length != 0) { var inputType = itemToUpdate.attr("type"); if (inputType != null && (inputType.toLowerCase() == "checkbox" || inputType.toLowerCase() == "radiobutton")) { if (newValue.toLowerCase() == "true") { itemToUpdate.checked = true } else { itemToUpdate.checked = false } } else { itemToUpdate.html(newFormattedValue) } } } } } if (isExternalDelete) { $('input[id^="' + oldItemRoot + '"]').remove(); if (deletedRecordCss != null) { var newSavePostFixD = eval(itemRoot + SavePostFixD); newSavePostFixD.addClass(deletedRecordCss); $("#" + itemRoot + DisplayPostfix + ContainerPostFix).replaceWith(newSavePostFixD.clone(true)) } } else { if (!isInsert) { if (changedDisplayAvailable) { eval(itemRoot + SavePostFixD + " = " + itemRoot + SavePostFixC + ";") } var newSavePostFixD = eval(itemRoot + SavePostFixD); $("#" + itemRoot + DisplayPostfix + ContainerPostFix).replaceWith(newSavePostFixD.clone(true)) } } } } if (detailType == "Display") { if (displayExecute != null) { eval(displayExecute + "();") } } else { if (editExecute != null) { eval(editExecute + "();") } } MvcControlsToolkit_DataGridApplyStylesItem(itemRoot); eval(baseName + "_DetailBusy = false;") } function ViewList_Client(groupName, hiddenField, cssSelected, prefix) { this.CssSelected = cssSelected; this.GroupName = groupName; this.HiddenField = hiddenField; this.Prefix = prefix; var allViews = $("." + groupName); allViews.each(function (i) { var name = this.id + "_placeholder"; var thisId = this.id; $("#" + thisId).before("<span style='display:none;' id='" + name + "'></span>"); $("." + thisId + "_checkbox").click(function () { if ($("." + thisId + "_checkbox")[0].checked) { eval(groupName + "_ViewList").Select(thisId) } else { eval(groupName + "_ViewList").Select("") } }) }); this.SelectionSet = allViews.detach(); this.SelectionSet.find("script").remove() } ViewList_Client.prototype = { HiddenField: null, GroupName: null, CssSelected: null, SelectionSet: null, Prefix: null, Select: function (a) { $("." + this.GroupName + "_button").removeClass(this.CssSelected); $("." + this.GroupName + "_checkbox").each(function (b) { this.checked = false }); $("." + this.GroupName).detach(); if (a == "") { document.getElementById(this.HiddenField).value = ""; return } document.getElementById(this.HiddenField).value = a; a = this.Prefix + a; this.SelectionSet.filter("#" + a).insertBefore("#" + a + "_placeholder"); $("." + a + "_button").addClass(this.CssSelected); $("." + a + "_checkbox").each(function (b) { this.checked = true }) } }; function ViewsOnOff_Client_Switch(groupName, on, hidden) { if (on) { $("." + groupName + "_checkbox").each(function (i) { this.checked = true }); var toAttach = eval(groupName + "_ViewsOnOff"); toAttach.each(function (i) { var currId = this.id; $(this).insertBefore("#" + currId + "_placeholder") }); document.getElementById(hidden).value = "True" } else { $("." + groupName + "_checkbox").each(function (i) { this.checked = false }); $("." + groupName).detach(); document.getElementById(hidden).value = "False" } } function ViewsOnOff_Client_Initialize(groupName, initial_on, hidden) { var allViews = $("." + groupName); allViews.each(function (i) { var prova = this.id; if (this.id == null || this.id == "") { this.id = groupName + "_el" + i } var name = this.id + "_placeholder"; var thisId = this.id; $("#" + this.id).before("<span style='display:none;' id='" + name + "'></span>"); $("." + groupName + "_checkbox").click(function (event) { ViewsOnOff_Client_Switch(groupName, event.target.checked, hidden) }) }); var selectionSet = allViews.detach(); selectionSet.find("script").remove(); eval(groupName + "_ViewsOnOff = selectionSet;"); if (initial_on) { $("." + groupName + "_checkbox").each(function (i) { this.checked = false }); selectionSet.each(function (i) { var currId = this.id; $(this).insertBefore("#" + currId + "_placeholder") }) } else { $("." + groupName + "_checkbox").each(function (i) { this.checked = false }) } } var MvcControlsToolkit_DataType_String = 0; var MvcControlsToolkit_DataType_UInt = 1; var MvcControlsToolkit_DataType_Int = 2; var MvcControlsToolkit_DataType_Float = 3; var MvcControlsToolkit_DataType_DateTime = 4; function MvcControlsToolkit_Format(c, d, a, b, e) { if (a < 0) { return c } if (c == null) { return "" } return b + MvcControlsToolkit_ToString(c, d, a) + e } function MvcControlsToolkit_FormatDisplay(d, e, b, c, f, a) { if (b < 0) { return d } if (d == null || d === "") { return a } return c + MvcControlsToolkit_ToString(d, e, b) + f } function MvcControlsToolkit_ToString(b, c, a) { if (a == MvcControlsToolkit_DataType_String || a < 0) { if (b === true) { return "True" } if (b === false) { return "False" } return b } if (b == null) { return "" } if (c == "") { if (a == MvcControlsToolkit_DataType_DateTime) { c = "d" } else { if (a == MvcControlsToolkit_DataType_Int || a == MvcControlsToolkit_DataType_UInt) { c = "d" } else { if (a == MvcControlsToolkit_DataType_Float) { c = "n" } else { return b } } } } if ((typeof jQuery !== "undefined") && (typeof jQuery.global !== "undefined") && (typeof jQuery.global.parseInt === "function")) { return jQuery.global.format(b, c) } else { if ((typeof Number !== "undefined") && (typeof Number.parseLocale === "function")) { return b.localeFormat(c) } else { return b + "" } } } function MvcControlsToolkit_Parse(c, b) { if (b == MvcControlsToolkit_DataType_String) { return c } if (c == "") { return null } if (b == MvcControlsToolkit_DataType_Float) { if ((typeof jQuery !== "undefined") && (typeof jQuery.global !== "undefined") && (typeof jQuery.global.parseFloat == "function")) { return jQuery.global.parseFloat(c) } else { if ((typeof Number !== "undefined") && (typeof Number.parseLocale == "function")) { return Number.parseLocale(c) } else { return parseFloat(c) } } } else { if (b == MvcControlsToolkit_DataType_DateTime) { if ((typeof jQuery !== "undefined") && (typeof jQuery.global !== "undefined") && (typeof jQuery.global.parseDate == "function")) { return jQuery.global.parseDate(c) } else { if ((typeof Date !== "undefined") && (typeof Date.parseLocale == "function")) { return Date.parseLocale(c) } else { return Date.parse(c) } } } else { if ((typeof jQuery !== "undefined") && (typeof jQuery.global !== "undefined") && (typeof jQuery.parseInt == "function")) { return jQuery.global.parseInt(c) } else { if (typeof Number.parseLocale == "function") { var a = Number.parseLocale(c); if (isNaN(a)) { return a } return parseInt(a + "") } else { return parseInt(c, 10) } } } } } function MvcControlsToolkit_TypedTextBox_Input(j, d, a, f, h, e, c, b) { if (f == MvcControlsToolkit_DataType_String || j == 0 || j == 13 || j == 8 || j == e.charCodeAt(0) || (j >= 48 && j <= 57)) { return true } if ((f == MvcControlsToolkit_DataType_Int || f == MvcControlsToolkit_DataType_Float) && (j == c.charCodeAt(0) || j == b.charCodeAt(0))) { var g = document.getElementById(d).value; return g.indexOf(c) < 0 && g.indexOf(b) < 0 } if (f == MvcControlsToolkit_DataType_Float && j == h.charCodeAt(0)) { var g = document.getElementById(d).value; return g.indexOf(h) < 0 } return false } function MvcControlsToolkit_TypedTextBox_Focus(a, c, b) { document.getElementById(a).value = document.getElementById(c).value; if (b != "") { $("#" + a).removeClass(b) } } function MvcControlsToolkit_DisplayEdit_DbClick(a, b) { $("#" + b).hide(); $("#" + a).show().focus() } function MvcControlsToolkit_TypedTextBox_Blur(q, x, p, m, s, t, u, b, d, l, h, j, g) { var a = document.getElementById(q); if (a == null) { return } var n = a.value; var o = n; if (p != MvcControlsToolkit_DataType_String) { n = MvcControlsToolkit_Trim(n); o = n; var f = n; f = f.replace(l, ""); tvalue = f.replace(u, ""); negative = f.indexOf(b); f = f.replace(b, ""); var w = ""; var c = ""; for (var r = 0; r < f.length; r++) { c = f.charCodeAt(r); if ((c >= 48 && c <= 57) || c == d.charCodeAt(0)) { w = w + f.charAt(r) } } f = w; if (n != "") { var k = 0; try { k = MvcControlsToolkit_Parse(f, p); if (negative >= 0) { k = k * -1 } if (!isNaN(k)) { n = MvcControlsToolkit_ToString(k, t, p); if (p == MvcControlsToolkit_DataType_Float) { if (negative >= 0) { o = b + f } else { o = f } } else { o = MvcControlsToolkit_ToString(k, "n0", p) } } } catch (v) { } } } document.getElementById(x).value = o; MvcControlsToolkit_Validate(x, g); $("#" + q).removeClass("input-validation-error"); if ($("#" + x).hasClass("input-validation-error")) { $("#" + q).addClass("input-validation-error") } if (n == "") { if (j != "") { $("#" + q).addClass(j) } document.getElementById(q).value = h } else { document.getElementById(q).value = m + n + s } $("#" + q).trigger("TypedTextBox_Changed") } function MvcControlsToolkit_DisplayEdit_Blur(p, w, o, l, r, s, t, b, d, k, h, g) { var a = document.getElementById(p); if (a == null) { return } var m = a.value; var n = m; if (o != MvcControlsToolkit_DataType_String) { m = MvcControlsToolkit_Trim(m); n = m; var f = m; f = f.replace(k, ""); tvalue = f.replace(t, ""); negative = f.indexOf(b); f = f.replace(b, ""); var v = ""; var c = ""; for (var q = 0; q < f.length; q++) { c = f.charCodeAt(q); if ((c >= 48 && c <= 57) || c == d.charCodeAt(0)) { v = v + f.charAt(q) } } f = v; if (m != "") { var j = 0; try { j = MvcControlsToolkit_Parse(f, o); if (negative >= 0) { j = j * -1 } if (!isNaN(j)) { m = MvcControlsToolkit_ToString(j, s, o); if (o == MvcControlsToolkit_DataType_Float) { if (negative >= 0) { n = b + f } else { n = f } } else { n = MvcControlsToolkit_ToString(j, "n0", o) } } } catch (u) { } } } a.value = n; MvcControlsToolkit_Validate(p, h); $("#" + p).hide(); $("#" + w).show(); if (m == "") { if (g == "") { $("#" + w).html("&nbsp;&nbsp;&nbsp;") } else { $("#" + w).text(g) } } else { $("#" + w).text(l + m + r) } $("#" + p).trigger("TypedEditDisplay_Changed") } function MvcControlsToolkit_TypedTextBox_SetString(b, a) { var b = $(b); b.trigger("focus"); b.val(a); b.trigger("blur") } function MvcControlsToolkit_TypedTextBox_GetString(a) { var b = a.id.substring(0, a.id.lastIndexOf("_")); return $("#" + b).val() } function MvcControlsToolkit_TypedTextBox_Set(c, b, f, h) { var e = $(c); var d = c.id.substring(0, c.id.lastIndexOf("_")); var g = $("#" + d); if (g.length == 0) { var a = function () { MvcControlsToolkit_TypedTextBox_Set(c, b, f, h) }; setTimeout(a, 0); return } var b = MvcControlsToolkit_Format(b, f, h, "", ""); g.val(b); e.val(b); e.trigger("pfocus"); e.trigger("pblur") } function MvcControlsToolkit_TypedTextBox_Get(a, c) { var b = a.id.substring(0, a.id.lastIndexOf("_")); return MvcControlsToolkit_Parse($("#" + b).val(), c) } function MvcControlsToolkit_TypedEditDisplay_SetString(b, a) { var b = $(b); b.val(a); b.trigger("blur") } function MvcControlsToolkit_TypedEditDisplay_GetString(a) { return $(a).val() } function MvcControlsToolkit_TypedEditDisplay_Set(b, a, d, e) { var c = $(b); $(b).val(MvcControlsToolkit_Format(a, d, e, "", "")); c.trigger("pblur") } function MvcControlsToolkit_TypedEditDisplay_Get(a, b) { return MvcControlsToolkit_Parse($(a).val(), b) } function MvcControlsToolkit_DisplayField_SetString(b, a) { return } function MvcControlsToolkit_DisplayField_GetString(field) { return eval(field.id + "_True") } function MvcControlsToolkit_AjaxLink(b, a) { $.ajax({ type: "GET", url: b, success: function (c) { $("#" + a).html(c) } }) } function MvcControlsToolkit_AjaxSubmit(a, b) { if (!MvcControlsToolkit_FormIsValid(b, a)) { return } $("#" + b).parents("form").submit() } $(document).ready(function () { $(".MvcControlsToolkit-Hover").mouseover(function () { $(this).addClass("MvcControlsToolkit-Hover-On") }); $(".MvcControlsToolkit-Hover").mouseout(function (a) { if (a.target.tagName.toLowerCase() == "select") { return } $(this).removeClass("MvcControlsToolkit-Hover-On") }) }); function MvcControlsToolkit_NewTemplateName(item) { if (eval("typeof _MvcControlsToolkit_" + item.ModelId + " === 'undefined'")) { jQuery.globalEval("var _MvcControlsToolkit_" + item.ModelId + " = 0;") } else { eval("_MvcControlsToolkit_" + item.ModelId + "++ ;") } return "" } function MvcControlsToolkit_TemplateName(item) { return item.ModelPrefix + "[" + eval("_MvcControlsToolkit_" + item.ModelId) + "]" } function MvcControlsToolkit_TemplateId(item) { return item.ModelId + "_" + eval("_MvcControlsToolkit_" + item.ModelId) + "_" } function MvcControlsToolkit_InitializeCreatedNodes(d, c, a, b, f, e) { if (d == null || (b && a)) { return } toApply = function () { for (var g = 0; g < d.length; g++) { if (c && f) { jQuery.validator.unobtrusive.parseExt(d[g]) } if (!b) { GlobalEvalScriptAndDestroy(d[g]) } if (!a) { var j = $(d[g]); var h = j.children(); h.trigger("blur"); h.trigger("change") } } }; setTimeout(toApply, 0) } function MvcControlsToolkit_ServerErrors(b) { var a = function () { for (var f = 0; f < b.length; f++) { var h = b[f]; var g = $("#" + h.id); if (g.length == 0) { continue } var d = g.parents("form").first(); if (d.length == 0) { continue } if (!g.hasClass("input-validation-error")) { g.addClass("input-validation-error") } var c = g.attr("companionpostfix"); if (typeof c !== "undefined" && c !== false) { var j = $("#" + h.id + c); if (j.length > 0 && !j.hasClass("input-validation-error")) { j.addClass("input-validation-error") } } var e = $(d).find("[data-valmsg-for='" + h.name + "']"); if (e.length > 0) { e.removeClass("field-validation-valid").addClass("field-validation-error"); replace = $.parseJSON(e.attr("data-valmsg-replace")) !== false; if (replace) { e.empty(); $(h.errors[0]).appendTo(e) } } } }; setTimeout(a, 0) };